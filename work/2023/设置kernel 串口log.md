# 串口log相关设置

## linux中的日志等级

Linux内核的printk日志级别有以下几个：

KERN_EMERG：紧急情况，系统无法使用。
KERN_ALERT：需要立即采取行动的情况。
KERN_CRIT：临界条件，例如硬件错误。
KERN_ERR：错误情况，但不会引起系统崩溃。
KERN_WARNING：警告条件，可能会导致问题。
KERN_NOTICE：一般性重要信息。
KERN_INFO：一般信息。
KERN_DEBUG：调试信息。
这些日志级别按照严重程度从高到低排列。级别越高，输出的日志越紧急或严重。

在内核代码中，可以使用宏printk来输出相应级别的日志。例如，要输出一个警告级别的日志，可以使用以下代码：

`printk(KERN_WARNING "This is a warning message\n");`

### 中断中使用打印

在中断上下文中一般不能使用printk向串口打印数据，因为串口是很耗时的操作。

printk_deferred函数是Linux内核中的一个函数，用于在软中断上下文中延迟输出日志消息。

与常规的printk函数不同，printk_deferred函数不会立即将日志消息输出到控制台或日志缓冲区。相反，它会将消息推迟到稍后的时间点输出，以避免在软中断上下文中引起延迟。

printk_deferred函数的日志级别与常规的printk函数相同，可以根据需要指定日志级别。

## linux中设置日志等级的节点

`/proc/sys/kernel/printk`

/proc/sys/kernel/printk是Linux中的一个文件，用于控制内核日志的级别和控制台输出格式。输出格式由四个数字组成，用空格分隔，分别对应控制台日志级别、默认日志级别、最小日志级别和引导时日志级别。

这里是每个数字的含义：

- 控制台日志级别：确定将打印到控制台的消息的最低严重级别。数字越高，输出越详细。例如，值为4将仅显示关键的内核消息，而值为7将显示所有内核消息。

- 默认日志级别：内核使用的默认日志级别。通常将其设置为比控制台日志级别更高的值，以过滤掉不重要的消息。

- 最小日志级别：确定将由内核记录的消息的最低严重级别。具有较低严重级别的消息将被丢弃。

- 引导时日志级别：引导过程中使用的日志级别。通常将其设置为比最小日志级别更高的值，以确保重要的引导消息被显示。

要修改输出格式，您可以使用以下格式将新值写入/proc/sys/kernel/printk文件：
`echo "<控制台日志级别> <默认日志级别> <最小日志级别> <引导时日志级别>" > /proc/sys/kernel/printk`

## 在开机阶段设置日志等级

要在Linux内核中设置输出日志的级别，您可以通过修改内核的启动参数来实现。下面是一种常见的方法：
在linux的cmdline中添加`loglevel=<level>`参数。其中`<level>`是您想要设置的日志级别，可选的级别包括：

0：禁用所有内核输出日志
1：仅输出关键错误消息
2：输出错误和警告消息
3：输出错误、警告和常规信息
4：输出错误、警告、常规信息和调试信息

## 关闭linux串口打印log

- 常规方法是将cmdline中console的定义改为quiet console=quiet
- 在MTK中，可以通过`/proc/mtprintk`接口设置， 其中0表示禁用串口打印，1表示使能。
还可以通过设置cmdline中的`mtk_printk_ctrl.disable_uart=0`参数控制输出，改值是在lk中配置然后传给kernel的。

<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/607711 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <meta name="content-class" content="yinxiang.markdown"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5710"/>

<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000; margin-top: 14px;">Bitmap泄漏问题总结</h1>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;">http://jira-ex.transsion.com:6001/browse/X6526V6AEE-107</p>
</blockquote>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">最近我司项目(<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">MTK</code>平台)跑<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">monkey</code>过程中出现<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">system_server JE</code> 导致上层重启<br/>
<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">system_server</code>发生 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">JE</code>的原因是: <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">system_server</code>进程 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">OutOfMemoryError</code><br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image.png" type="image/png" data-filename="Image.png"/></p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">E AndroidRuntime: *** FATAL EXCEPTION IN SYSTEM PROCESS: binder:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1375</span>_1A
E AndroidRuntime: java.lang.OutOfMemoryError: pthread_create (<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1040</span>KB <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">stack</span>) failed: Try again
E AndroidRuntime: 	at java.lang.Thread.nativeCreate(Native Method)
E AndroidRuntime: 	at java.lang.Thread.start(Thread.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">976</span>)
E AndroidRuntime: 	at com.android.server.pm.AbstractStatsBase.maybeWriteAsync(AbstractStatsBase.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">85</span>)
E AndroidRuntime: 	at com.android.server.pm.dex.PackageDynamicCodeLoading.maybeWriteAsync(PackageDynamicCodeLoading.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">244</span>)
E AndroidRuntime: 	at com.android.server.pm.dex.DynamicCodeLogger.recordDex(DynamicCodeLogger.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">227</span>)
E AndroidRuntime: 	at com.android.server.pm.dex.DexManager.notifyDexLoadInternal(DexManager.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">269</span>)
E AndroidRuntime: 	at com.android.server.pm.dex.DexManager.notifyDexLoad(DexManager.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">198</span>)
E AndroidRuntime: 	at com.android.server.pm.PackageManagerService$IPackageManagerImpl.notifyDexLoad(PackageManagerService.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">5519</span>)
E AndroidRuntime: 	at android.content.pm.IPackageManager$Stub.onTransact(IPackageManager.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">3301</span>)
E AndroidRuntime: 	at com.android.server.pm.PackageManagerService$IPackageManagerImpl.onTransact(PackageManagerService.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">6231</span>)
E AndroidRuntime: 	at android.os.Binder.execTransactInternal(Binder.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1286</span>)
E AndroidRuntime: 	at android.os.Binder.execTransact(Binder.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1245</span>)
E AndroidRuntime: OutOfMemoryError IN SYSTEM PROCESS: Already dump hprof!
E AndroidRuntime: java.lang.OutOfMemoryError: pthread_create (<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1040</span>KB <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">stack</span>) failed: Try again
E AndroidRuntime: 	at java.lang.Thread.nativeCreate(Native Method)
E AndroidRuntime: 	at java.lang.Thread.start(Thread.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">976</span>)
E AndroidRuntime: 	at com.android.server.pm.AbstractStatsBase.maybeWriteAsync(AbstractStatsBase.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">85</span>)
E AndroidRuntime: 	at com.android.server.pm.dex.PackageDynamicCodeLoading.maybeWriteAsync(PackageDynamicCodeLoading.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">244</span>)
E AndroidRuntime: 	at com.android.server.pm.dex.DynamicCodeLogger.recordDex(DynamicCodeLogger.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">227</span>)
E AndroidRuntime: 	at com.android.server.pm.dex.DexManager.notifyDexLoadInternal(DexManager.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">269</span>)
E AndroidRuntime: 	at com.android.server.pm.dex.DexManager.notifyDexLoad(DexManager.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">198</span>)
E AndroidRuntime: 	at com.android.server.pm.PackageManagerService$IPackageManagerImpl.notifyDexLoad(PackageManagerService.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">5519</span>)
E AndroidRuntime: 	at android.content.pm.IPackageManager$Stub.onTransact(IPackageManager.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">3301</span>)
E AndroidRuntime: 	at com.android.server.pm.PackageManagerService$IPackageManagerImpl.onTransact(PackageManagerService.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">6231</span>)
E AndroidRuntime: 	at android.os.Binder.execTransactInternal(Binder.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1286</span>)
E AndroidRuntime: 	at android.os.Binder.execTransact(Binder.java:<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1245</span>)
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">(出现这类调用栈,貌似只能表明该进程内存溢出了,调用栈只表明此时申请内存时,已经申请不到了,并不能说明是此处导致内存溢出)</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">1.排查异常log</h2>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;">尽可能通过现有log,排查可能的异常点,联系异常log对应模块同事尽可能获取更多信息</p>
</blockquote>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">由于我司<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Monkey</code>是使用自己的自动化测试平台进行测试,log只有<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mtk d</code>b文件以及<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">main log</code>.无hprof文件.较难排查.<br/>
好在从有限的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">log</code>中能排查到异常点,通过<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">log</code>,尝试手动复现找到问题的必现路径.</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">通过<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">log</code>排查,我们可以看到<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">system_server</code>发生<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">OOM</code>之前有异常<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">log</code>:</p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">system_server</code>进程不能申请到bitmap内存数据</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">bitmap</code>打印<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">out of memory</code>警告<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap : mmap failed, error 12 (Out of memory)</code></li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="Bitmap泄漏system_server重启问题总结_files/Image [1].png" type="image/png" data-filename="Image.png"/><br/>
如下能看到频繁的log:</p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">客户定制<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">appwidget</code>相关的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">log</code> 频繁打印,经咨询客户对应工程师表明.</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">该<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">log</code>是打印出<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">appwidget</code>行为以及<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">type</code> 是此时<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">appwidge</code>t的行为</li>
</ul>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">WIDGET_TYPE_ADD = 0</li>
<li style="line-height: 160%; box-sizing: content-box;">WIDGET_TYPE_UPDATE = 1</li>
<li style="line-height: 160%; box-sizing: content-box;">WIDGET_TYPE_REMOVE = 2</li>
</ol>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">可见此时这么多的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">appwidget</code>正在更新<br/>
小部件: 录音机:<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">com.transsion.soundrecorder</code><br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [2].png" type="image/png" data-filename="Image.png"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">根据以上<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">log</code>,我们不难想到可能是<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Monkey</code>场景下频繁添加录音机小部件导致的.</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">2.找到问题复现路径</h2>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;">尝试缩小问题复现场景,通过<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">log</code>尝试手动复现问题,(找必现路径过程中,实时观察是否有先前怀疑的异常<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">log</code>打出)</p>
</blockquote>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">2.1复现路径</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">本来我打算让测试同事在<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Launcher</code>+<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">录音机</code> 这个场景下使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">userdebug</code>版本去压测复现.后来自己尝试添加完100个录音机小部件后,左右滑动,手机没有问题(动态输出log中没有看到上述异常log).<br/>
当我尝试打开录音小部件按钮开始录音,异常log开始打印.桌面滑动也变得顿卡.100个小部件同时更新UI(计时变化),小部件UI也顿卡,正常小部件UI时间显示是1s一次,顿卡时3/4s更新一次尝试两三次亮灭屏手机卡死.稍后system_server OOM 导致重启.复现到此问题(可查看附件录屏:<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap泄漏system_server重启_resource\1_问题log复现路径录屏.mp4</code>)</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="Bitmap泄漏system_server重启问题总结_files/Image [3].png" type="image/png" data-filename="Image.png"/><br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [4].png" type="image/png" data-filename="Image.png"/></p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">2.1抓取完整log</h3>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;">抓取<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">log</code>(hprof,mobile_log,db等),以及录屏<br/>
如附件: Bitmap泄漏system_server重启_resource\1_问题log</p>
</blockquote>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">Userdebug版本问题复现后,</p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">将<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">data/hprof</code>下的文件导出来(<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap泄漏system_server重启_resource\1_问题log\3_data_hprof\system_server_OOM_1375_2023-10-09-10-32-43.hprof</code>)</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">hprof-conv.exe</code>(from:<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AppData\Local\Android\Sdk\tools</code>) 工具转换.(可在附件:<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap泄漏system_server重启_resource\2_分析工具\hprof-conv.exe</code>)</li>
</ul>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;">hprof-conv system_server_OOM_1375_2023-10-09-10-32-43.hprof hsy.hprof</p>
</blockquote>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">3.问题排查</h2>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">3.1 Mat(Memory Analyzer)分析</h3>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">再使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mat(Memory Analyzer)</code>工具解析查看释放存在泄漏以及哪些类内存占用过高.(工具:<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap泄漏system_server重启_resource\2_分析工具\MemoryAnalyzer-1.14.0.20230315-win32.win32.x86_64 (2).zip</code>)<br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [5].png" type="image/png" data-filename="Image.png"/></li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">从图标来看,三个实例的内存占用应该是正常的,因为我们的场景如此.添加了100个小部件情况下.</p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">com.android.server.appwidget.AppWidgetServiceImpl$Widget</code>--100</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">android.widget.RemoteViews</code>--104</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">所以只能知道此场景下这两个实例占用内存会较多.</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">3.2 AS.profiler排查</h3>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;">由于场景必现,可以使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AndroidStudio.profiler</code>工具实时排查</p>
</blockquote>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Memory Analyzer</code>工具有个局限性,就是只能看到<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Java</code>相关内存信息.<br/>
并且由于问题复现场景已经确定,我们可以使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Android studio</code>中的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Profiler</code>工具实时查看场景运行过程中<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">system_server</code>的内存信息,这里的内存信息就较多,<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">JAVA</code>和<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Native</code>的都能看得到.<br/>
关于这几项信息解释(看文末 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">### 4.1 hprof的几个内存关键参数解释</code>)</p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">Native Size</strong></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">Shallow Size</strong></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">Retained Size</strong></li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">我们使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Retained Size</code>项来进行排序.<br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [6].png" type="image/png" data-filename="Image.png"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">我们能看到占比较高的是:</p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code> 的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Retained size</code>较高,内存主要是来自<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Native</code> 的占用较高,其次就是基础数据类型:<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">ArrayList</code>和<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Object</code></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">其次就是刚刚
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView$ReflectionAction</code></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AppWidgetServiceImpl</code></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AppWidgetServiceImpl$Widget</code></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteViews</code></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Icon</code></li>
</ul>
</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">我们可以点击上面各个实例查看让他们的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">GC root</code></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AppWidgetServiceImpl</code><br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [7].png" type="image/png" data-filename="Image.png"/></p>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AppWidgetServiceImpl$Widget</code><br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [8].png" type="image/png" data-filename="Image.png"/></p>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteViews</code><br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [9].png" type="image/png" data-filename="Image.png"/></p>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">ArrayList</code><br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [10].png" type="image/png" data-filename="Image.png"/></p>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView$ReflectionAction</code><br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [11].png" type="image/png" data-filename="Image.png"/></p>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Icon</code><br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [12].png" type="image/png" data-filename="Image.png"/></p>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code><br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [13].png" type="image/png" data-filename="Image.png"/></p>
</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">从上面的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">GC root</code>路径,大家应该能看出来.占用最高这几个实例都是相互关联的(同时可以留意红框右边的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Depth</code>栏,<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">GCroot</code>的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Depth</code>值最小)<br/>
从根到各个对象顺序如下<br/>
<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AppWidgetServiceImpl</code>--&gt;<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AppWidgetServiceImpl$Widget</code>--&gt;<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteViews</code>--&gt;<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">ArrayList</code><br/>
--&gt;<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView$ReflectionAction</code>--&gt;<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Icon</code>--&gt;<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">我们可以在<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AppWidgetServiceImpl</code>的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Fields</code>项 查看这个路径(虽然不太直观,但是能看到各个成员的关系)<br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [14].png" type="image/png" data-filename="Image.png"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">为了直观我将数量也统计上去<br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [15].png" type="image/png" data-filename="Image.png"/></p>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;">描述</p>
</blockquote>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AppWidgetServiceImpl</code>中的成员<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mWidget</code>是一个<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">ArrayList</code></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mWidget</code>中每一项存放这个多个<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AppWidgetServiceImpl$Widget</code> 实例</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">AppWidgetServiceImpl$Widget</code>中的 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">views</code>成员存放着一个<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">ArrayList:mActions</code></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mActions</code>中每一项都存放着<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView$ReflectionAction</code>实例</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView$ReflectionAction</code>中的包含成员<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">value</code></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">value</code>中存放成员<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mObj1</code>,这个<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mObj1</code>存放着<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code></li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">此时我们已经能看到问题的根本原因:在于大量的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code>未能被释放.<br/>
由于大量Bitmap占用内存较多,所以我这边咨询了一下录音机同事是如何更新小部件UI的,以及RemoteViews /BitmapReflectionAction是如何使用的?</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//相关同事给的答复</span>
widgetView.setImageViewIcon(R.id.bg_view, getBgBitmap(widgetInfo, op(widgetInfo.isLargeScreen(), startBgArray[theme], normalBg), theme).toIcon())
widgetView.setImageViewResource(R.id.icon, op(widgetInfo.isWidthCell5, startSmallIconArray[theme], startIconArray[theme]))

setImageViewIcon    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//是更新背景</span>

setImageViewResource<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//是更新小部件左边的按钮</span>
</code></pre>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">3.3 找到泄漏怀疑点</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">从上可以看到确实有在使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code>添加到<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">widgetView</code>中<br/>
我们需要查找Bitmap未能释放的原因,我们可以开始从<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code>到<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">GCroot</code>回溯哪里存在异常.或者从<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">GCroot</code>开始往下查找.<br/>
1.从<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code>开始回溯.选中一个<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code> 实例<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Instance</code>(选择同类型出现最多的其中一个即可) 查看<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">References</code>项选中 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Show nearest GCroot</code><br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [16].png" type="image/png" data-filename="Image.png"/><br/>
查看红框中这些成员哪些数量多,哪些可以释放但是迟迟未被释放.需要查看代码逻辑.<br/>
结合我统计的那个图可以知道,以下两个成员是较多的</p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mWidgets</code> <strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">100</strong>个实例<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Widget</code></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mActions</code>  <strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">1287</strong>个实例<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Action</code></li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">由于我添加了100个录音小部件所以对应会生成着 100个<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mWidget</code>的列表实例<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Widget</code>,这里显然释放不了,除非我将小部件一个个移除掉<br/>
那么<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mActions</code>呢?<br/>
每一个<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Widget</code>间接存放着1000多个<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mActions</code>的列表成员<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Action</code>.这里显然太多了.这里将是一个怀疑点</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">3.4 查看怀疑点相关代码</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">通过查阅代码发现.录音机更新小部件<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">UI</code>是通过<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">setImageViewIcon(,)</code>接口,接口中将<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code> 封装为<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">ReflectionAction</code>存在<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mActions</code> 中.通过查看<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mActions</code>发现,包含的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Action</code>只会不断增加.移除<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mActions</code>列表中各个<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">action</code>的唯一方法为 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">partiallyUpdateAppWidget</code>.<br/>
通过查阅发现这个方法基本上很少有<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">apk</code>使用.经常使用的接口为<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">appWidgetManager.updateAppWidget</code>,此次录音机应用也是调用的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">updateAppWidget</code>接口进行更新<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">UI</code>.<br/>
查看<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteViews.java</code>代码发现<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView</code>中的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">set开头</code>的方法均会new一个新的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">XXXaction</code>添加<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mActions</code>中</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">frameworks/base/core/java/android/widget/RemoteViews.<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">java
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">setImageViewIcon</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(@IdRes <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> viewId, Icon icon)</span> </span>{
        setIcon(viewId, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;setImageIcon&quot;</span>, icon);
    }
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">setIcon</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(@IdRes <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> viewId, String methodName, Icon value)</span> </span>{
        addAction(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">new</span> ReflectionAction(viewId, methodName, BaseReflectionAction.ICON, value));
    }
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">setImageViewResource</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(@IdRes <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> viewId, @DrawableRes <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> srcId)</span> </span>{
        setInt(viewId, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;setImageResource&quot;</span>, srcId);
    }
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">setInt</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(@IdRes <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> viewId, String methodName, <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> value)</span> </span>{
        addAction(<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">new</span> ReflectionAction(viewId, methodName, BaseReflectionAction.INT, value));
    }
	<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//...等等方法均会new一个Action添加到mAction成员中</span>
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">排查<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">appWidgetManager.updateAppWidget</code> 代码流程:<br/>
代理端的接口最终会调用导服务端的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">updateAppWidgetIds(,)</code>接口</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//frameworks/base/services/appwidget/java/com/android/server/appwidget/AppWidgetServiceImpl.java</span>
<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//调用的方法为updateAppWidgetIds</span>
    @<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">Override
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">updateAppWidgetIds</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(String callingPackage, <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>[] appWidgetIds,
            RemoteViews views)</span> </span>{
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (DEBUG) {<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//因为有必现路径,我将还将此DEBUG这个开关打开了,为了能发现更多信息</span>
            Slog.i(TAG, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;updateAppWidgetIds() &quot;</span> + UserHandle.getCallingUserId());
        }

        updateAppWidgetIds(callingPackage, appWidgetIds, views, <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">false</span>);<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//详见: updateAppWidgetIds</span>
    }
<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//这个是刚刚提到的 partiallyUpdateAppWidget调用到的接口</span>
    @<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">Override
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">partiallyUpdateAppWidgetIds</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(String callingPackage, <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>[] appWidgetIds,
            RemoteViews views)</span> </span>{
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (DEBUG) {
            Slog.i(TAG, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;partiallyUpdateAppWidgetIds() &quot;</span> + UserHandle.getCallingUserId());
        }
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//参数最后一个为true,最终会将新旧两个action合并,即移除mActions的唯一地方</span>
        updateAppWidgetIds(callingPackage, appWidgetIds, views, <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">true</span>);
    }
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">updateAppWidgetIds(,)</strong><br/>
通过appWidgetId 找到对应的小部件进行跟新</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">private</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">updateAppWidgetIds</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(String callingPackage, <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>[] appWidgetIds,
            RemoteViews views, boolean partially)</span> </span>{
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//部分省略</span>
        synchronized (mLock) {
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">final</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> N = appWidgetIds.length;
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span> (<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> i = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">0</span>; i &lt; N; i++) {
                <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">final</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> appWidgetId = appWidgetIds[i];
                <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//....</span>
                Widget widget = lookupWidgetLocked(appWidgetId,
                        Binder.getCallingUid(), callingPackage);

                <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (widget != null) {
                    updateAppWidgetInstanceLocked(widget, views, partially);<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//详见updateAppWidgetInstanceLocked(widget, views, partially)</span>
                }
            }
        }
    }
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">updateAppWidgetInstanceLocked(,,)</strong><br/>
分析如下</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">private</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">void</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">updateAppWidgetInstanceLocked</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(Widget widget, RemoteViews views,
            boolean isPartialUpdate)</span> </span>{
            <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//...</span>
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> (isPartialUpdate &amp;&amp; widget.views != null) {
                <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// For a partial update, we merge the new RemoteViews with the old.</span>
                widget.views.mergeRemoteViews(views);
            } <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">else</span> {
                <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// For a full update we replace the RemoteViews completely.</span>
                widget.views = views;
            }
            <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//这里将会统计小部件中使用BitMap内存,如果超过屏幕宽×高×1.5×4大小将会抛出异常造成应用异常退出,</span>
            <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//***我们这个问题system_server重启前出现了录音机由于这个原因闪退可查看crashlog中信息,能看到</span>
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> memoryUsage;
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> ((UserHandle.getAppId(Binder.getCallingUid()) != Process.SYSTEM_UID) &amp;&amp;
                    (widget.views != null) &amp;&amp;
                    ((memoryUsage = widget.views.estimateMemoryUsage()) &gt; mMaxWidgetBitmapMemory)) {
                widget.views = null;
                <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">throw</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">new</span> IllegalArgumentException(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;RemoteViews for widget update exceeds&quot;</span>
                        + <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot; maximum bitmap memory usage (used: &quot;</span> + memoryUsage
                        + <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;, max: &quot;</span> + mMaxWidgetBitmapMemory + <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;)&quot;</span>);
            }
            scheduleNotifyUpdateAppWidgetLocked(widget, widget.getEffectiveViewsLocked());
        }
    }
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">如果是部分跟新(<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">partiallyUpdateAppWidget</code>),将会将<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView</code>中的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mAction</code>进行新老<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">action</code>合并,如果已经存在的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">action</code> 那么新的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">action</code>将会丢掉(其实看到这里我有想让录音同事使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">partiallyUpdateAppWidget</code>代替使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">UpdateAppWidget</code>,但是查阅api资料后,发现两者并不是提代的关系,使用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">partiallyUpdateAppWidget</code>场景并不是在添加action之后,所以没有让其修改)</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">如果是<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">UpdateAppWidget</code>则将新的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView</code>替换老的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView</code>,间接说明<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mAction</code>也会跟着变化(老RemoteView将会被回收,那么Action也将会被回收,bitmap也将被回收).<br/>
从这里来看,正常来说一RemoteView不应该像hprof中那样有1000多个action的.而且action大多都是包含Bitmap.看到这里我怀疑难道录音机应用的代码中将RemoteView保存着,重复使用吗?</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">所以咨询了一下录音机的开发是否在代码中将RemoteView保存着,重复使用</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="Bitmap泄漏system_server重启问题总结_files/Image [17].png" type="image/png" data-filename="Image.png"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">后面我要了一份关于 录音机小部件实现的代码 即AppWidgetProvider类的实现地方(附件: <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap泄漏system_server重启_resource\AppWidgetProvider.txt</code>)</p>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;">我们主要关注:<br/>
1.remote是否被复用<br/>
2.以及UpdateAppWidget的调用时机</p>
</blockquote>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">RecorderWidgetProvider</span>: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">AppWidgetProvider</span></span>() {
    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//无关代码我进行省略</span>
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">override</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">fun</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">onUpdate</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(context: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">Context</span>, appWidgetManager: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">AppWidgetManager</span>, appWidgetIds: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">IntArray</span>)</span></span> {
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">super</span>.onUpdate(context, appWidgetManager, appWidgetIds)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">val</span> widgetView = RemoteViews(context.packageName, R.layout.recorder_widget_layout)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//&lt;---------异常点RemoteViews存在复用,100个小部件场景,100个小部件共用一个RemoteView</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span> (widgetId <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> appWidgetIds) {
            updateWidgetView(context.applicationContext, widgetView, appWidgetManager, widgetId)
        }
    }
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">private</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">fun</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">updateWidgetView</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(context: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">Context</span>, widgetView: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">RemoteViews</span>, manager: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">AppWidgetManager</span>, appWidgetId: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">Int</span>)</span></span> {
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//....省略</span>
        widgetView.setImageViewIcon(R.id.bg_view, getBgBitmap(XXX).toIcon())
        widgetView.setImageViewResource(R.id.icon, op(XXX))
        manager.updateAppWidget(appWidgetId, widgetView)<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//&lt;----------------调用updateAppWidget进行更新</span>
    }
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">override</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">fun</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">onEnabled</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(context: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">Context</span>?)</span></span> {
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//...</span>
    }
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">override</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">fun</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">onDisabled</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(context: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">Context</span>?)</span></span> {
         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//...</span>
    }
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">override</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">fun</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">onReceive</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(context: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">Context</span>, intent: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">Intent</span>)</span></span> {
         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//...</span>
    }
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">override</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">fun</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">onAppWidgetOptionsChanged</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(context: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">Context</span>, appWidgetManager: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">AppWidgetManager</span>, appWidgetId: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">Int</span>, newOptions: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">Bundle</span>)</span></span> {
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//...</span>
    }
}

</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">从上面的代码我们确实能发现存在<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView</code>复用的情况:<br/>
即一个<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView</code>调用<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">setImageViewIcon</code>,所有其他小部件被引用的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView</code>中的<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">mActions</code>列表都会增加</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">3.5修改建议</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">我给录音机开发同事提建议将<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView</code> 放到<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">for循环</code>中,这样一个小部件就只使用自己的一个<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">RemoteView</code>.</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">RecorderWidgetProvider</span>: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">AppWidgetProvider</span></span>() {
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">override</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">fun</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">onUpdate</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(context: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">Context</span>, appWidgetManager: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">AppWidgetManager</span>, appWidgetIds: <span style="color: #4ec9b0; line-height: 160%; box-sizing: content-box;">IntArray</span>)</span></span> {
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">super</span>.onUpdate(context, appWidgetManager, appWidgetIds)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">for</span> (widgetId <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">in</span> appWidgetIds) {
            \\appWidget对应一个新RemoteView
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">val</span> widgetView = RemoteViews(context.packageName, R.layout.recorder_widget_layout)\\appWidget对应一个新RemoteView
            updateWidgetView(context.applicationContext, widgetView, appWidgetManager, widgetId)
        }
    }
}
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">使用修改后的录音机进行在相同手机系统版本测试,手机使用流畅,小部件UI流畅,亮灭屏10多次,未见重启,也未见打印bitmap异常log(可看附件中修改的录屏)<br/>
抓了一份录音6小时后<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">hprof</code>(<code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap泄漏system_server重启_resource\1_问题log\After_Modified_Catch_memory-20231012T210526.hprof</code>),<br/>
看一下是不是bitMap的分配个数和内存的大小是不是小很多比起之前</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="Bitmap泄漏system_server重启问题总结_files/Image [18].png" type="image/png" data-filename="Image.png"/></p>
<table style="margin: 2px 0 14px; color: #333; width: auto; border-collapse: collapse; box-sizing: border-box;"><thead style="line-height: 160%; box-sizing: content-box;"><tr style="line-height: 160%; box-sizing: content-box;"><th style="line-height: 160%; box-sizing: content-box; padding: 5px 14px 5px 12px; border: 1px solid #72777b; border-top: 0; background-color: #7b8184; font-weight: 300; color: #fff; padding-top: 6px;">时间</th><th style="line-height: 160%; box-sizing: content-box; padding: 5px 14px 5px 12px; border: 1px solid #72777b; border-top: 0; background-color: #7b8184; font-weight: 300; color: #fff; padding-top: 6px;">异常时Allocations</th><th style="line-height: 160%; box-sizing: content-box; padding: 5px 14px 5px 12px; border: 1px solid #72777b; border-top: 0; background-color: #7b8184; font-weight: 300; color: #fff; padding-top: 6px;">Native Size</th></tr></thead><tbody style="line-height: 160%; box-sizing: content-box;"><tr style="line-height: 160%; box-sizing: content-box;"><td style="line-height: 160%; box-sizing: content-box; padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">异常时</td><td style="line-height: 160%; box-sizing: content-box; padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">11122</td><td style="line-height: 160%; box-sizing: content-box; padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">754702978</td></tr><tr style="line-height: 160%; box-sizing: content-box;"><td style="line-height: 160%; box-sizing: content-box; padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">修改后</td><td style="line-height: 160%; box-sizing: content-box; padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">554</td><td style="line-height: 160%; box-sizing: content-box; padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">45047954</td></tr></tbody></table>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">4.参考</h2>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">4.1 hprof的几个内存关键参数解释</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">关于这几项的信息如下</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">Allocations</strong>：堆中的分配数。<br/>
<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">Native Size</strong>：此对象类型使用的原生内存总量（以字节为单位）。只有在使用 Android 7.0 及更高版本时，才会看到此列。您会在此处看到采用 Java 分配的某些对象的内存，因为 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Android</code>对某些框架类（如 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code>）使用原生内存。<br/>
<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">Shallow Size</strong>：此对象类型使用的 Java 内存总量（以字节为单位）。<br/>
<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">Retained Size</strong>：为此类的所有实例而保留的内存总大小（以字节为单位）。</p>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;">from:https://developer.android.google.cn/studio/profile/memory-profiler?hl=zh-cn</p>
</blockquote>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">上面几个概念来源官网比较生硬,较容易理解的如下:</p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">Native Size</strong></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">Shallow Size</strong></li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;"><strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">Retained Size</strong></li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">我们用下图来表示某段 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Heap Dump</code> 记录的应用内存状态。注意红色的节点，在这个示例中，这个节点所代表的对象从我们的工程中引用了 Native 对象:<br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [19].png" type="image/png" data-filename="Image.png"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">这种情况不太常见，但在 Android 8.0 之后，使用 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code> 便可能产生此类情景，因为 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Bitmap</code> 会把像素信息存储在原生内存中来减少 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">JVM</code> 的内存压力。(我们的这个问题就是这样)</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">先从 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Shallow Size</code> 讲起，这列数据其实非常简单，就是对象本身消耗的内存大小，在上图中，即为<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">红色节点</strong>自身所占内存。而 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Native Size</code> 同样也很简单，它是类对象所引用的 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Native</code> 对象 (<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">蓝色节点</strong>) 所消耗的内存大小:</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="Bitmap泄漏system_server重启问题总结_files/Image [20].png" type="image/png" data-filename="Image.png"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Retained Size</code> 稍复杂些，它是下图中所有橙色节点的大小:<br/>
<img src="Bitmap泄漏system_server重启问题总结_files/Image [21].png" type="image/png" data-filename="Image.png"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">由于一旦删除红色节点，其余的橙色节点都将无法被访问，这时候它们就会被 GC 回收掉。从这个角度上讲，它们是被红色节点所持有的，因此被命名为 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Retained Size</code>。<br/>
参考</p>
<blockquote style="line-height: 160%; box-sizing: content-box; margin: 15px 0; border-left: 4px solid #ddd; padding: 0 15px; color: #777;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333; margin-top: 0; margin-bottom: 0;">使用 Android Studio Profiler 工具解析应用的内存和 CPU 使用数据<br/>
https://mp.weixin.qq.com/s/MIuSi85lnrETqq3rl0Hc6A<br/>
RemoteViews 中暗藏的坑<br/>
https://blog.csdn.net/u013989732/article/details/78501462</p>
</blockquote>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%23%20Bitmap%E6%B3%84%E6%BC%8F%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93%0A%0A%3Ehttp%3A%2F%2Fjira-ex.transsion.com%3A6001%2Fbrowse%2FX6526V6AEE-107%0A%0A%E6%9C%80%E8%BF%91%E6%88%91%E5%8F%B8%E9%A1%B9%E7%9B%AE(%60MTK%60%E5%B9%B3%E5%8F%B0)%E8%B7%91%60monkey%60%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%87%BA%E7%8E%B0%60system_server%20JE%60%20%E5%AF%BC%E8%87%B4%E4%B8%8A%E5%B1%82%E9%87%8D%E5%90%AF%0A%60system_server%60%E5%8F%91%E7%94%9F%20%60JE%60%E7%9A%84%E5%8E%9F%E5%9B%A0%E6%98%AF%3A%20%60system_server%60%E8%BF%9B%E7%A8%8B%20%60OutOfMemoryError%60%0A!%5B2c7c413d4ea2be299b61274ac35a9a8f.png%5D(en-resource%3A%2F%2Fdatabase%2F5716%3A1)%0A%0A%60%60%60cpp%0AE%20AndroidRuntime%3A%20***%20FATAL%20EXCEPTION%20IN%20SYSTEM%20PROCESS%3A%20binder%3A1375_1A%0AE%20AndroidRuntime%3A%20java.lang.OutOfMemoryError%3A%20pthread_create%20(1040KB%20stack)%20failed%3A%20Try%20again%0AE%20AndroidRuntime%3A%20%09at%20java.lang.Thread.nativeCreate(Native%20Method)%0AE%20AndroidRuntime%3A%20%09at%20java.lang.Thread.start(Thread.java%3A976)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.AbstractStatsBase.maybeWriteAsync(AbstractStatsBase.java%3A85)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.dex.PackageDynamicCodeLoading.maybeWriteAsync(PackageDynamicCodeLoading.java%3A244)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.dex.DynamicCodeLogger.recordDex(DynamicCodeLogger.java%3A227)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.dex.DexManager.notifyDexLoadInternal(DexManager.java%3A269)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.dex.DexManager.notifyDexLoad(DexManager.java%3A198)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.PackageManagerService%24IPackageManagerImpl.notifyDexLoad(PackageManagerService.java%3A5519)%0AE%20AndroidRuntime%3A%20%09at%20android.content.pm.IPackageManager%24Stub.onTransact(IPackageManager.java%3A3301)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.PackageManagerService%24IPackageManagerImpl.onTransact(PackageManagerService.java%3A6231)%0AE%20AndroidRuntime%3A%20%09at%20android.os.Binder.execTransactInternal(Binder.java%3A1286)%0AE%20AndroidRuntime%3A%20%09at%20android.os.Binder.execTransact(Binder.java%3A1245)%0AE%20AndroidRuntime%3A%20OutOfMemoryError%20IN%20SYSTEM%20PROCESS%3A%20Already%20dump%20hprof!%0AE%20AndroidRuntime%3A%20java.lang.OutOfMemoryError%3A%20pthread_create%20(1040KB%20stack)%20failed%3A%20Try%20again%0AE%20AndroidRuntime%3A%20%09at%20java.lang.Thread.nativeCreate(Native%20Method)%0AE%20AndroidRuntime%3A%20%09at%20java.lang.Thread.start(Thread.java%3A976)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.AbstractStatsBase.maybeWriteAsync(AbstractStatsBase.java%3A85)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.dex.PackageDynamicCodeLoading.maybeWriteAsync(PackageDynamicCodeLoading.java%3A244)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.dex.DynamicCodeLogger.recordDex(DynamicCodeLogger.java%3A227)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.dex.DexManager.notifyDexLoadInternal(DexManager.java%3A269)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.dex.DexManager.notifyDexLoad(DexManager.java%3A198)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.PackageManagerService%24IPackageManagerImpl.notifyDexLoad(PackageManagerService.java%3A5519)%0AE%20AndroidRuntime%3A%20%09at%20android.content.pm.IPackageManager%24Stub.onTransact(IPackageManager.java%3A3301)%0AE%20AndroidRuntime%3A%20%09at%20com.android.server.pm.PackageManagerService%24IPackageManagerImpl.onTransact(PackageManagerService.java%3A6231)%0AE%20AndroidRuntime%3A%20%09at%20android.os.Binder.execTransactInternal(Binder.java%3A1286)%0AE%20AndroidRuntime%3A%20%09at%20android.os.Binder.execTransact(Binder.java%3A1245)%0A%60%60%60%0A(%E5%87%BA%E7%8E%B0%E8%BF%99%E7%B1%BB%E8%B0%83%E7%94%A8%E6%A0%88%2C%E8%B2%8C%E4%BC%BC%E5%8F%AA%E8%83%BD%E8%A1%A8%E6%98%8E%E8%AF%A5%E8%BF%9B%E7%A8%8B%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA%E4%BA%86%2C%E8%B0%83%E7%94%A8%E6%A0%88%E5%8F%AA%E8%A1%A8%E6%98%8E%E6%AD%A4%E6%97%B6%E7%94%B3%E8%AF%B7%E5%86%85%E5%AD%98%E6%97%B6%2C%E5%B7%B2%E7%BB%8F%E7%94%B3%E8%AF%B7%E4%B8%8D%E5%88%B0%E4%BA%86%2C%E5%B9%B6%E4%B8%8D%E8%83%BD%E8%AF%B4%E6%98%8E%E6%98%AF%E6%AD%A4%E5%A4%84%E5%AF%BC%E8%87%B4%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA)%0A%23%23%201.%E6%8E%92%E6%9F%A5%E5%BC%82%E5%B8%B8log%0A%3E%E5%B0%BD%E5%8F%AF%E8%83%BD%E9%80%9A%E8%BF%87%E7%8E%B0%E6%9C%89log%2C%E6%8E%92%E6%9F%A5%E5%8F%AF%E8%83%BD%E7%9A%84%E5%BC%82%E5%B8%B8%E7%82%B9%2C%E8%81%94%E7%B3%BB%E5%BC%82%E5%B8%B8log%E5%AF%B9%E5%BA%94%E6%A8%A1%E5%9D%97%E5%90%8C%E4%BA%8B%E5%B0%BD%E5%8F%AF%E8%83%BD%E8%8E%B7%E5%8F%96%E6%9B%B4%E5%A4%9A%E4%BF%A1%E6%81%AF%0A%0A%E7%94%B1%E4%BA%8E%E6%88%91%E5%8F%B8%60Monkey%60%E6%98%AF%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E5%B9%B3%E5%8F%B0%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95%2Clog%E5%8F%AA%E6%9C%89%60mtk%20d%60b%E6%96%87%E4%BB%B6%E4%BB%A5%E5%8F%8A%60main%20log%60.%E6%97%A0hprof%E6%96%87%E4%BB%B6.%E8%BE%83%E9%9A%BE%E6%8E%92%E6%9F%A5.%0A%E5%A5%BD%E5%9C%A8%E4%BB%8E%E6%9C%89%E9%99%90%E7%9A%84%60log%60%E4%B8%AD%E8%83%BD%E6%8E%92%E6%9F%A5%E5%88%B0%E5%BC%82%E5%B8%B8%E7%82%B9%2C%E9%80%9A%E8%BF%87%60log%60%2C%E5%B0%9D%E8%AF%95%E6%89%8B%E5%8A%A8%E5%A4%8D%E7%8E%B0%E6%89%BE%E5%88%B0%E9%97%AE%E9%A2%98%E7%9A%84%E5%BF%85%E7%8E%B0%E8%B7%AF%E5%BE%84.%0A%0A%E9%80%9A%E8%BF%87%60log%60%E6%8E%92%E6%9F%A5%2C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%60system_server%60%E5%8F%91%E7%94%9F%60OOM%60%E4%B9%8B%E5%89%8D%E6%9C%89%E5%BC%82%E5%B8%B8%60log%60%3A%0A*%20%60system_server%60%E8%BF%9B%E7%A8%8B%E4%B8%8D%E8%83%BD%E7%94%B3%E8%AF%B7%E5%88%B0bitmap%E5%86%85%E5%AD%98%E6%95%B0%E6%8D%AE%0A*%20%60bitmap%60%E6%89%93%E5%8D%B0%60out%20of%20memory%60%E8%AD%A6%E5%91%8A%60Bitmap%20%20%3A%20mmap%20failed%2C%20error%2012%20(Out%20of%20memory)%60%0A%0A!%5B0d1f5dbc4070f8ae6e8d5476a3a810bd.png%5D(en-resource%3A%2F%2Fdatabase%2F5712%3A1)%0A%E5%A6%82%E4%B8%8B%E8%83%BD%E7%9C%8B%E5%88%B0%E9%A2%91%E7%B9%81%E7%9A%84log%3A%0A*%20%E5%AE%A2%E6%88%B7%E5%AE%9A%E5%88%B6%60appwidget%20%60%E7%9B%B8%E5%85%B3%E7%9A%84%60log%60%20%E9%A2%91%E7%B9%81%E6%89%93%E5%8D%B0%2C%E7%BB%8F%E5%92%A8%E8%AF%A2%E5%AE%A2%E6%88%B7%E5%AF%B9%E5%BA%94%E5%B7%A5%E7%A8%8B%E5%B8%88%E8%A1%A8%E6%98%8E.%0A*%20%E8%AF%A5%60log%60%E6%98%AF%E6%89%93%E5%8D%B0%E5%87%BA%60appwidget%60%E8%A1%8C%E4%B8%BA%E4%BB%A5%E5%8F%8A%60type%60%20%E6%98%AF%E6%AD%A4%E6%97%B6%60appwidge%60t%E7%9A%84%E8%A1%8C%E4%B8%BA%0A%0A1.%20WIDGET_TYPE_ADD%20%3D%200%0A2.%20WIDGET_TYPE_UPDATE%20%3D%201%0A3.%20WIDGET_TYPE_REMOVE%20%3D%202%0A%0A%E5%8F%AF%E8%A7%81%E6%AD%A4%E6%97%B6%E8%BF%99%E4%B9%88%E5%A4%9A%E7%9A%84%60appwidget%60%E6%AD%A3%E5%9C%A8%E6%9B%B4%E6%96%B0%0A%E5%B0%8F%E9%83%A8%E4%BB%B6%3A%20%E5%BD%95%E9%9F%B3%E6%9C%BA%3A%60com.transsion.soundrecorder%60%0A!%5Bfc8bc252aa2db61ec5f7fde7078b45f7.png%5D(en-resource%3A%2F%2Fdatabase%2F5714%3A1)%0A%0A%E6%A0%B9%E6%8D%AE%E4%BB%A5%E4%B8%8A%60log%60%2C%E6%88%91%E4%BB%AC%E4%B8%8D%E9%9A%BE%E6%83%B3%E5%88%B0%E5%8F%AF%E8%83%BD%E6%98%AF%60Monkey%60%E5%9C%BA%E6%99%AF%E4%B8%8B%E9%A2%91%E7%B9%81%E6%B7%BB%E5%8A%A0%E5%BD%95%E9%9F%B3%E6%9C%BA%E5%B0%8F%E9%83%A8%E4%BB%B6%E5%AF%BC%E8%87%B4%E7%9A%84.%0A%23%23%202.%E6%89%BE%E5%88%B0%E9%97%AE%E9%A2%98%E5%A4%8D%E7%8E%B0%E8%B7%AF%E5%BE%84%0A%3E%E5%B0%9D%E8%AF%95%E7%BC%A9%E5%B0%8F%E9%97%AE%E9%A2%98%E5%A4%8D%E7%8E%B0%E5%9C%BA%E6%99%AF%2C%E9%80%9A%E8%BF%87%60log%60%E5%B0%9D%E8%AF%95%E6%89%8B%E5%8A%A8%E5%A4%8D%E7%8E%B0%E9%97%AE%E9%A2%98%2C(%E6%89%BE%E5%BF%85%E7%8E%B0%E8%B7%AF%E5%BE%84%E8%BF%87%E7%A8%8B%E4%B8%AD%2C%E5%AE%9E%E6%97%B6%E8%A7%82%E5%AF%9F%E6%98%AF%E5%90%A6%E6%9C%89%E5%85%88%E5%89%8D%E6%80%80%E7%96%91%E7%9A%84%E5%BC%82%E5%B8%B8%60log%60%E6%89%93%E5%87%BA)%0A%0A%23%23%23%202.1%E5%A4%8D%E7%8E%B0%E8%B7%AF%E5%BE%84%0A%E6%9C%AC%E6%9D%A5%E6%88%91%E6%89%93%E7%AE%97%E8%AE%A9%E6%B5%8B%E8%AF%95%E5%90%8C%E4%BA%8B%E5%9C%A8%60Launcher%60%2B%60%E5%BD%95%E9%9F%B3%E6%9C%BA%60%20%E8%BF%99%E4%B8%AA%E5%9C%BA%E6%99%AF%E4%B8%8B%E4%BD%BF%E7%94%A8%60userdebug%60%E7%89%88%E6%9C%AC%E5%8E%BB%E5%8E%8B%E6%B5%8B%E5%A4%8D%E7%8E%B0.%E5%90%8E%E6%9D%A5%E8%87%AA%E5%B7%B1%E5%B0%9D%E8%AF%95%E6%B7%BB%E5%8A%A0%E5%AE%8C100%E4%B8%AA%E5%BD%95%E9%9F%B3%E6%9C%BA%E5%B0%8F%E9%83%A8%E4%BB%B6%E5%90%8E%2C%E5%B7%A6%E5%8F%B3%E6%BB%91%E5%8A%A8%2C%E6%89%8B%E6%9C%BA%E6%B2%A1%E6%9C%89%E9%97%AE%E9%A2%98(%E5%8A%A8%E6%80%81%E8%BE%93%E5%87%BAlog%E4%B8%AD%E6%B2%A1%E6%9C%89%E7%9C%8B%E5%88%B0%E4%B8%8A%E8%BF%B0%E5%BC%82%E5%B8%B8log).%0A%E5%BD%93%E6%88%91%E5%B0%9D%E8%AF%95%E6%89%93%E5%BC%80%E5%BD%95%E9%9F%B3%E5%B0%8F%E9%83%A8%E4%BB%B6%E6%8C%89%E9%92%AE%E5%BC%80%E5%A7%8B%E5%BD%95%E9%9F%B3%2C%E5%BC%82%E5%B8%B8log%E5%BC%80%E5%A7%8B%E6%89%93%E5%8D%B0.%E6%A1%8C%E9%9D%A2%E6%BB%91%E5%8A%A8%E4%B9%9F%E5%8F%98%E5%BE%97%E9%A1%BF%E5%8D%A1.100%E4%B8%AA%E5%B0%8F%E9%83%A8%E4%BB%B6%E5%90%8C%E6%97%B6%E6%9B%B4%E6%96%B0UI(%E8%AE%A1%E6%97%B6%E5%8F%98%E5%8C%96)%2C%E5%B0%8F%E9%83%A8%E4%BB%B6UI%E4%B9%9F%E9%A1%BF%E5%8D%A1%2C%E6%AD%A3%E5%B8%B8%E5%B0%8F%E9%83%A8%E4%BB%B6UI%E6%97%B6%E9%97%B4%E6%98%BE%E7%A4%BA%E6%98%AF1s%E4%B8%80%E6%AC%A1%2C%E9%A1%BF%E5%8D%A1%E6%97%B63%2F4s%E6%9B%B4%E6%96%B0%E4%B8%80%E6%AC%A1%E5%B0%9D%E8%AF%95%E4%B8%A4%E4%B8%89%E6%AC%A1%E4%BA%AE%E7%81%AD%E5%B1%8F%E6%89%8B%E6%9C%BA%E5%8D%A1%E6%AD%BB.%E7%A8%8D%E5%90%8Esystem_server%20OOM%20%E5%AF%BC%E8%87%B4%E9%87%8D%E5%90%AF.%E5%A4%8D%E7%8E%B0%E5%88%B0%E6%AD%A4%E9%97%AE%E9%A2%98(%E5%8F%AF%E6%9F%A5%E7%9C%8B%E9%99%84%E4%BB%B6%E5%BD%95%E5%B1%8F%3A%60Bitmap%E6%B3%84%E6%BC%8Fsystem_server%E9%87%8D%E5%90%AF_resource%5C1_%E9%97%AE%E9%A2%98log%E5%A4%8D%E7%8E%B0%E8%B7%AF%E5%BE%84%E5%BD%95%E5%B1%8F.mp4%60)%0A%0A!%5B370b8878b5e64b3fdc3ae9426d9ad863.png%5D(en-resource%3A%2F%2Fdatabase%2F5718%3A1)%0A!%5Bbbaa1e571c6207900f404e98738e99aa.png%5D(en-resource%3A%2F%2Fdatabase%2F5720%3A1)%0A%0A%23%23%23%202.1%E6%8A%93%E5%8F%96%E5%AE%8C%E6%95%B4log%0A%3E%E6%8A%93%E5%8F%96%60log%60(hprof%2Cmobile_log%2Cdb%E7%AD%89)%2C%E4%BB%A5%E5%8F%8A%E5%BD%95%E5%B1%8F%0A%3E%E5%A6%82%E9%99%84%E4%BB%B6%3A%20Bitmap%E6%B3%84%E6%BC%8Fsystem_server%E9%87%8D%E5%90%AF_resource%5C1_%E9%97%AE%E9%A2%98log%0A%0AUserdebug%E7%89%88%E6%9C%AC%E9%97%AE%E9%A2%98%E5%A4%8D%E7%8E%B0%E5%90%8E%2C%0A*%20%E5%B0%86%60data%2Fhprof%60%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%E5%AF%BC%E5%87%BA%E6%9D%A5(%60Bitmap%E6%B3%84%E6%BC%8Fsystem_server%E9%87%8D%E5%90%AF_resource%5C1_%E9%97%AE%E9%A2%98log%5C3_data_hprof%5Csystem_server_OOM_1375_2023-10-09-10-32-43.hprof%60)%0A*%20%E4%BD%BF%E7%94%A8%60hprof-conv.exe%60(from%3A%60AppData%5CLocal%5CAndroid%5CSdk%5Ctools%60)%20%E5%B7%A5%E5%85%B7%E8%BD%AC%E6%8D%A2.(%E5%8F%AF%E5%9C%A8%E9%99%84%E4%BB%B6%3A%60Bitmap%E6%B3%84%E6%BC%8Fsystem_server%E9%87%8D%E5%90%AF_resource%5C2_%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%5Chprof-conv.exe%60)%0A%3Ehprof-conv%20system_server_OOM_1375_2023-10-09-10-32-43.hprof%20hsy.hprof%0A%0A%23%23%203.%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%0A%23%23%23%203.1%20Mat(Memory%20Analyzer)%E5%88%86%E6%9E%90%0A*%20%E5%86%8D%E4%BD%BF%E7%94%A8%60mat(Memory%20Analyzer)%60%E5%B7%A5%E5%85%B7%E8%A7%A3%E6%9E%90%E6%9F%A5%E7%9C%8B%E9%87%8A%E6%94%BE%E5%AD%98%E5%9C%A8%E6%B3%84%E6%BC%8F%E4%BB%A5%E5%8F%8A%E5%93%AA%E4%BA%9B%E7%B1%BB%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E8%BF%87%E9%AB%98.(%E5%B7%A5%E5%85%B7%3A%60Bitmap%E6%B3%84%E6%BC%8Fsystem_server%E9%87%8D%E5%90%AF_resource%5C2_%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%5CMemoryAnalyzer-1.14.0.20230315-win32.win32.x86_64%20(2).zip%60)%0A!%5B25ced645b2866293df46693c091b9c1f.png%5D(en-resource%3A%2F%2Fdatabase%2F5722%3A1)%0A%0A%0A%0A%E4%BB%8E%E5%9B%BE%E6%A0%87%E6%9D%A5%E7%9C%8B%2C%E4%B8%89%E4%B8%AA%E5%AE%9E%E4%BE%8B%E7%9A%84%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E5%BA%94%E8%AF%A5%E6%98%AF%E6%AD%A3%E5%B8%B8%E7%9A%84%2C%E5%9B%A0%E4%B8%BA%E6%88%91%E4%BB%AC%E7%9A%84%E5%9C%BA%E6%99%AF%E5%A6%82%E6%AD%A4.%E6%B7%BB%E5%8A%A0%E4%BA%86100%E4%B8%AA%E5%B0%8F%E9%83%A8%E4%BB%B6%E6%83%85%E5%86%B5%E4%B8%8B.%0A%0A*%20%60com.android.server.appwidget.AppWidgetServiceImpl%24Widget%60--100%0A*%20%60android.widget.RemoteViews%60--104%0A%0A%E6%89%80%E4%BB%A5%E5%8F%AA%E8%83%BD%E7%9F%A5%E9%81%93%E6%AD%A4%E5%9C%BA%E6%99%AF%E4%B8%8B%E8%BF%99%E4%B8%A4%E4%B8%AA%E5%AE%9E%E4%BE%8B%E5%8D%A0%E7%94%A8%E5%86%85%E5%AD%98%E4%BC%9A%E8%BE%83%E5%A4%9A.%0A%0A%23%23%23%203.2%20AS.profiler%E6%8E%92%E6%9F%A5%0A%3E%E7%94%B1%E4%BA%8E%E5%9C%BA%E6%99%AF%E5%BF%85%E7%8E%B0%2C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%60AndroidStudio.profiler%60%E5%B7%A5%E5%85%B7%E5%AE%9E%E6%97%B6%E6%8E%92%E6%9F%A5%0A%0A%E4%BD%BF%E7%94%A8%60Memory%20Analyzer%60%E5%B7%A5%E5%85%B7%E6%9C%89%E4%B8%AA%E5%B1%80%E9%99%90%E6%80%A7%2C%E5%B0%B1%E6%98%AF%E5%8F%AA%E8%83%BD%E7%9C%8B%E5%88%B0%60Java%60%E7%9B%B8%E5%85%B3%E5%86%85%E5%AD%98%E4%BF%A1%E6%81%AF.%0A%E5%B9%B6%E4%B8%94%E7%94%B1%E4%BA%8E%E9%97%AE%E9%A2%98%E5%A4%8D%E7%8E%B0%E5%9C%BA%E6%99%AF%E5%B7%B2%E7%BB%8F%E7%A1%AE%E5%AE%9A%2C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%60Android%20studio%60%E4%B8%AD%E7%9A%84%60Profiler%60%E5%B7%A5%E5%85%B7%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E5%9C%BA%E6%99%AF%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B%E4%B8%AD%60system_server%60%E7%9A%84%E5%86%85%E5%AD%98%E4%BF%A1%E6%81%AF%2C%E8%BF%99%E9%87%8C%E7%9A%84%E5%86%85%E5%AD%98%E4%BF%A1%E6%81%AF%E5%B0%B1%E8%BE%83%E5%A4%9A%2C%60JAVA%60%E5%92%8C%60Native%60%E7%9A%84%E9%83%BD%E8%83%BD%E7%9C%8B%E5%BE%97%E5%88%B0.%0A%E5%85%B3%E4%BA%8E%E8%BF%99%E5%87%A0%E9%A1%B9%E4%BF%A1%E6%81%AF%E8%A7%A3%E9%87%8A(%E7%9C%8B%E6%96%87%E6%9C%AB%20%60%23%23%23%204.1%20hprof%E7%9A%84%E5%87%A0%E4%B8%AA%E5%86%85%E5%AD%98%E5%85%B3%E9%94%AE%E5%8F%82%E6%95%B0%E8%A7%A3%E9%87%8A%60)%0A*%20**Native%20Size**%0A*%20**Shallow%20Size**%0A*%20**Retained%20Size**%0A%0A%0A%E6%88%91%E4%BB%AC%E4%BD%BF%E7%94%A8%60Retained%20Size%60%E9%A1%B9%E6%9D%A5%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F.%0A!%5Ba7ed026643f5c386cbe4b2e56791e2ac.png%5D(en-resource%3A%2F%2Fdatabase%2F5724%3A1)%0A%0A%0A%E6%88%91%E4%BB%AC%E8%83%BD%E7%9C%8B%E5%88%B0%E5%8D%A0%E6%AF%94%E8%BE%83%E9%AB%98%E7%9A%84%E6%98%AF%3A%0A*%20%60Bitmap%60%20%E7%9A%84%60Retained%20size%60%E8%BE%83%E9%AB%98%2C%E5%86%85%E5%AD%98%E4%B8%BB%E8%A6%81%E6%98%AF%E6%9D%A5%E8%87%AA%60Native%60%20%E7%9A%84%E5%8D%A0%E7%94%A8%E8%BE%83%E9%AB%98%2C%E5%85%B6%E6%AC%A1%E5%B0%B1%E6%98%AF%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%3A%60ArrayList%60%E5%92%8C%60Object%60%0A*%20%E5%85%B6%E6%AC%A1%E5%B0%B1%E6%98%AF%E5%88%9A%E5%88%9A%0A%20%20%20%20*%20%60RemoteView%24ReflectionAction%60%0A%20%20%20%20*%20%60AppWidgetServiceImpl%60%0A%20%20%20%20*%20%60AppWidgetServiceImpl%24Widget%60%0A%20%20%20%20*%20%60RemoteViews%60%0A%20%20%20%20*%20%60Icon%60%0A%20%20%20%20%0A%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%82%B9%E5%87%BB%E4%B8%8A%E9%9D%A2%E5%90%84%E4%B8%AA%E5%AE%9E%E4%BE%8B%E6%9F%A5%E7%9C%8B%E8%AE%A9%E4%BB%96%E4%BB%AC%E7%9A%84%60GC%20root%60%0A*%20%60AppWidgetServiceImpl%60%0A!%5B32a4cafee0be12503a591ffe5d24a2ab.png%5D(en-resource%3A%2F%2Fdatabase%2F5738%3A1)%0A*%20%60AppWidgetServiceImpl%24Widget%60%0A!%5B0ab28e99e14e39c05939907507f54c1f.png%5D(en-resource%3A%2F%2Fdatabase%2F5728%3A1)%0A*%20%60RemoteViews%60%0A!%5Bb214de03935992a93f4b4aff248198c7.png%5D(en-resource%3A%2F%2Fdatabase%2F5740%3A1)%0A%0A*%20%60ArrayList%60%0A!%5Ba6b5f32b240d0b27ea42f244f039b9f5.png%5D(en-resource%3A%2F%2Fdatabase%2F5736%3A1)%0A%0A*%20%60RemoteView%24ReflectionAction%60%0A!%5B955601e8d7c31b3e374d734727203df3.png%5D(en-resource%3A%2F%2Fdatabase%2F5726%3A1)%0A%0A*%20%60Icon%60%0A!%5Bfb3a1cc04bbfb7623dba5ad873f537ec.png%5D(en-resource%3A%2F%2Fdatabase%2F5732%3A1)%0A*%20%60Bitmap%60%0A!%5B79351674a781a991a8f3b791627f78f5.png%5D(en-resource%3A%2F%2Fdatabase%2F5734%3A1)%0A%0A%E4%BB%8E%E4%B8%8A%E9%9D%A2%E7%9A%84%60GC%20root%60%E8%B7%AF%E5%BE%84%2C%E5%A4%A7%E5%AE%B6%E5%BA%94%E8%AF%A5%E8%83%BD%E7%9C%8B%E5%87%BA%E6%9D%A5.%E5%8D%A0%E7%94%A8%E6%9C%80%E9%AB%98%E8%BF%99%E5%87%A0%E4%B8%AA%E5%AE%9E%E4%BE%8B%E9%83%BD%E6%98%AF%E7%9B%B8%E4%BA%92%E5%85%B3%E8%81%94%E7%9A%84(%E5%90%8C%E6%97%B6%E5%8F%AF%E4%BB%A5%E7%95%99%E6%84%8F%E7%BA%A2%E6%A1%86%E5%8F%B3%E8%BE%B9%E7%9A%84%60Depth%60%E6%A0%8F%2C%60GCroot%60%E7%9A%84%60Depth%60%E5%80%BC%E6%9C%80%E5%B0%8F)%0A%E4%BB%8E%E6%A0%B9%E5%88%B0%E5%90%84%E4%B8%AA%E5%AF%B9%E8%B1%A1%E9%A1%BA%E5%BA%8F%E5%A6%82%E4%B8%8B%0A%60AppWidgetServiceImpl%60--%3E%60AppWidgetServiceImpl%24Widget%60--%3E%60RemoteViews%60--%3E%60ArrayList%60%0A--%3E%60RemoteView%24ReflectionAction%60--%3E%60Icon%60--%3E%60Bitmap%60%0A%0A%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%9C%A8%60AppWidgetServiceImpl%60%E7%9A%84%60Fields%60%E9%A1%B9%20%E6%9F%A5%E7%9C%8B%E8%BF%99%E4%B8%AA%E8%B7%AF%E5%BE%84(%E8%99%BD%E7%84%B6%E4%B8%8D%E5%A4%AA%E7%9B%B4%E8%A7%82%2C%E4%BD%86%E6%98%AF%E8%83%BD%E7%9C%8B%E5%88%B0%E5%90%84%E4%B8%AA%E6%88%90%E5%91%98%E7%9A%84%E5%85%B3%E7%B3%BB)%0A!%5B5c20f0dd2d579fc571c2f9245812e395.png%5D(en-resource%3A%2F%2Fdatabase%2F5742%3A1)%0A%0A%0A%E4%B8%BA%E4%BA%86%E7%9B%B4%E8%A7%82%E6%88%91%E5%B0%86%E6%95%B0%E9%87%8F%E4%B9%9F%E7%BB%9F%E8%AE%A1%E4%B8%8A%E5%8E%BB%0A!%5B5af840624dcc6cbf40e6a0c2b800e958.png%5D(en-resource%3A%2F%2Fdatabase%2F5744%3A1)%0A%0A%0A%3E%E6%8F%8F%E8%BF%B0%0A*%20%60AppWidgetServiceImpl%60%E4%B8%AD%E7%9A%84%E6%88%90%E5%91%98%60mWidget%60%E6%98%AF%E4%B8%80%E4%B8%AA%60ArrayList%60%0A*%20%60mWidget%60%E4%B8%AD%E6%AF%8F%E4%B8%80%E9%A1%B9%E5%AD%98%E6%94%BE%E8%BF%99%E4%B8%AA%E5%A4%9A%E4%B8%AA%60AppWidgetServiceImpl%24Widget%60%20%E5%AE%9E%E4%BE%8B%0A*%20%60AppWidgetServiceImpl%24Widget%60%E4%B8%AD%E7%9A%84%20%60views%60%E6%88%90%E5%91%98%E5%AD%98%E6%94%BE%E7%9D%80%E4%B8%80%E4%B8%AA%60ArrayList%3AmActions%60%0A*%20%60mActions%60%E4%B8%AD%E6%AF%8F%E4%B8%80%E9%A1%B9%E9%83%BD%E5%AD%98%E6%94%BE%E7%9D%80%60RemoteView%24ReflectionAction%60%E5%AE%9E%E4%BE%8B%0A*%20%60RemoteView%24ReflectionAction%60%E4%B8%AD%E7%9A%84%E5%8C%85%E5%90%AB%E6%88%90%E5%91%98%60value%60%0A*%20%60value%60%E4%B8%AD%E5%AD%98%E6%94%BE%E6%88%90%E5%91%98%60mObj1%60%2C%E8%BF%99%E4%B8%AA%60mObj1%60%E5%AD%98%E6%94%BE%E7%9D%80%60Bitmap%60%0A%0A%E6%AD%A4%E6%97%B6%E6%88%91%E4%BB%AC%E5%B7%B2%E7%BB%8F%E8%83%BD%E7%9C%8B%E5%88%B0%E9%97%AE%E9%A2%98%E7%9A%84%E6%A0%B9%E6%9C%AC%E5%8E%9F%E5%9B%A0%3A%E5%9C%A8%E4%BA%8E%E5%A4%A7%E9%87%8F%E7%9A%84%60Bitmap%60%E6%9C%AA%E8%83%BD%E8%A2%AB%E9%87%8A%E6%94%BE.%0A%E7%94%B1%E4%BA%8E%E5%A4%A7%E9%87%8FBitmap%E5%8D%A0%E7%94%A8%E5%86%85%E5%AD%98%E8%BE%83%E5%A4%9A%2C%E6%89%80%E4%BB%A5%E6%88%91%E8%BF%99%E8%BE%B9%E5%92%A8%E8%AF%A2%E4%BA%86%E4%B8%80%E4%B8%8B%E5%BD%95%E9%9F%B3%E6%9C%BA%E5%90%8C%E4%BA%8B%E6%98%AF%E5%A6%82%E4%BD%95%E6%9B%B4%E6%96%B0%E5%B0%8F%E9%83%A8%E4%BB%B6UI%E7%9A%84%2C%E4%BB%A5%E5%8F%8ARemoteViews%20%2FBitmapReflectionAction%E6%98%AF%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E7%9A%84%3F%0A%60%60%60java%0A%2F%2F%E7%9B%B8%E5%85%B3%E5%90%8C%E4%BA%8B%E7%BB%99%E7%9A%84%E7%AD%94%E5%A4%8D%0AwidgetView.setImageViewIcon(R.id.bg_view%2C%20getBgBitmap(widgetInfo%2C%20op(widgetInfo.isLargeScreen()%2C%20startBgArray%5Btheme%5D%2C%20normalBg)%2C%20theme).toIcon())%0AwidgetView.setImageViewResource(R.id.icon%2C%20op(widgetInfo.isWidthCell5%2C%20startSmallIconArray%5Btheme%5D%2C%20startIconArray%5Btheme%5D))%0A%0AsetImageViewIcon%20%20%20%20%2F%2F%E6%98%AF%E6%9B%B4%E6%96%B0%E8%83%8C%E6%99%AF%0A%0AsetImageViewResource%2F%2F%E6%98%AF%E6%9B%B4%E6%96%B0%E5%B0%8F%E9%83%A8%E4%BB%B6%E5%B7%A6%E8%BE%B9%E7%9A%84%E6%8C%89%E9%92%AE%0A%60%60%60%0A%0A%23%23%23%203.3%20%E6%89%BE%E5%88%B0%E6%B3%84%E6%BC%8F%E6%80%80%E7%96%91%E7%82%B9%0A%E4%BB%8E%E4%B8%8A%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E7%A1%AE%E5%AE%9E%E6%9C%89%E5%9C%A8%E4%BD%BF%E7%94%A8%60Bitmap%60%E6%B7%BB%E5%8A%A0%E5%88%B0%60widgetView%60%E4%B8%AD%0A%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E6%9F%A5%E6%89%BEBitmap%E6%9C%AA%E8%83%BD%E9%87%8A%E6%94%BE%E7%9A%84%E5%8E%9F%E5%9B%A0%2C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%BC%80%E5%A7%8B%E4%BB%8E%60Bitmap%60%E5%88%B0%60GCroot%60%E5%9B%9E%E6%BA%AF%E5%93%AA%E9%87%8C%E5%AD%98%E5%9C%A8%E5%BC%82%E5%B8%B8.%E6%88%96%E8%80%85%E4%BB%8E%60GCroot%60%E5%BC%80%E5%A7%8B%E5%BE%80%E4%B8%8B%E6%9F%A5%E6%89%BE.%0A1.%E4%BB%8E%60Bitmap%60%E5%BC%80%E5%A7%8B%E5%9B%9E%E6%BA%AF.%E9%80%89%E4%B8%AD%E4%B8%80%E4%B8%AA%60Bitmap%60%20%E5%AE%9E%E4%BE%8B%60Instance%60(%E9%80%89%E6%8B%A9%E5%90%8C%E7%B1%BB%E5%9E%8B%E5%87%BA%E7%8E%B0%E6%9C%80%E5%A4%9A%E7%9A%84%E5%85%B6%E4%B8%AD%E4%B8%80%E4%B8%AA%E5%8D%B3%E5%8F%AF)%20%E6%9F%A5%E7%9C%8B%60References%60%E9%A1%B9%E9%80%89%E4%B8%AD%20%60Show%20nearest%20GCroot%60%0A!%5B206bd0e5df0cc35170608c8804daeb87.png%5D(en-resource%3A%2F%2Fdatabase%2F5752%3A1)%0A%E6%9F%A5%E7%9C%8B%E7%BA%A2%E6%A1%86%E4%B8%AD%E8%BF%99%E4%BA%9B%E6%88%90%E5%91%98%E5%93%AA%E4%BA%9B%E6%95%B0%E9%87%8F%E5%A4%9A%2C%E5%93%AA%E4%BA%9B%E5%8F%AF%E4%BB%A5%E9%87%8A%E6%94%BE%E4%BD%86%E6%98%AF%E8%BF%9F%E8%BF%9F%E6%9C%AA%E8%A2%AB%E9%87%8A%E6%94%BE.%E9%9C%80%E8%A6%81%E6%9F%A5%E7%9C%8B%E4%BB%A3%E7%A0%81%E9%80%BB%E8%BE%91.%0A%E7%BB%93%E5%90%88%E6%88%91%E7%BB%9F%E8%AE%A1%E7%9A%84%E9%82%A3%E4%B8%AA%E5%9B%BE%E5%8F%AF%E4%BB%A5%E7%9F%A5%E9%81%93%2C%E4%BB%A5%E4%B8%8B%E4%B8%A4%E4%B8%AA%E6%88%90%E5%91%98%E6%98%AF%E8%BE%83%E5%A4%9A%E7%9A%84%0A*%20%60mWidgets%60%20**100**%E4%B8%AA%E5%AE%9E%E4%BE%8B%60Widget%60%0A*%20%60mActions%60%20%20**1287**%E4%B8%AA%E5%AE%9E%E4%BE%8B%60Action%60%0A%0A%E7%94%B1%E4%BA%8E%E6%88%91%E6%B7%BB%E5%8A%A0%E4%BA%86100%E4%B8%AA%E5%BD%95%E9%9F%B3%E5%B0%8F%E9%83%A8%E4%BB%B6%E6%89%80%E4%BB%A5%E5%AF%B9%E5%BA%94%E4%BC%9A%E7%94%9F%E6%88%90%E7%9D%80%20100%E4%B8%AA%60mWidget%60%E7%9A%84%E5%88%97%E8%A1%A8%E5%AE%9E%E4%BE%8B%60Widget%60%2C%E8%BF%99%E9%87%8C%E6%98%BE%E7%84%B6%E9%87%8A%E6%94%BE%E4%B8%8D%E4%BA%86%2C%E9%99%A4%E9%9D%9E%E6%88%91%E5%B0%86%E5%B0%8F%E9%83%A8%E4%BB%B6%E4%B8%80%E4%B8%AA%E4%B8%AA%E7%A7%BB%E9%99%A4%E6%8E%89%0A%E9%82%A3%E4%B9%88%60mActions%60%E5%91%A2%3F%20%0A%E6%AF%8F%E4%B8%80%E4%B8%AA%60Widget%60%E9%97%B4%E6%8E%A5%E5%AD%98%E6%94%BE%E7%9D%801000%E5%A4%9A%E4%B8%AA%60mActions%60%E7%9A%84%E5%88%97%E8%A1%A8%E6%88%90%E5%91%98%60Action%60.%E8%BF%99%E9%87%8C%E6%98%BE%E7%84%B6%E5%A4%AA%E5%A4%9A%E4%BA%86.%E8%BF%99%E9%87%8C%E5%B0%86%E6%98%AF%E4%B8%80%E4%B8%AA%E6%80%80%E7%96%91%E7%82%B9%0A%0A%23%23%23%203.4%20%E6%9F%A5%E7%9C%8B%E6%80%80%E7%96%91%E7%82%B9%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81%0A%E9%80%9A%E8%BF%87%E6%9F%A5%E9%98%85%E4%BB%A3%E7%A0%81%E5%8F%91%E7%8E%B0.%E5%BD%95%E9%9F%B3%E6%9C%BA%E6%9B%B4%E6%96%B0%E5%B0%8F%E9%83%A8%E4%BB%B6%60UI%60%E6%98%AF%E9%80%9A%E8%BF%87%60setImageViewIcon(%2C)%60%E6%8E%A5%E5%8F%A3%2C%E6%8E%A5%E5%8F%A3%E4%B8%AD%E5%B0%86%60Bitmap%60%20%E5%B0%81%E8%A3%85%E4%B8%BA%60ReflectionAction%60%E5%AD%98%E5%9C%A8%60mActions%60%20%E4%B8%AD.%E9%80%9A%E8%BF%87%E6%9F%A5%E7%9C%8B%60mActions%60%E5%8F%91%E7%8E%B0%2C%E5%8C%85%E5%90%AB%E7%9A%84%60Action%60%E5%8F%AA%E4%BC%9A%E4%B8%8D%E6%96%AD%E5%A2%9E%E5%8A%A0.%E7%A7%BB%E9%99%A4%60mActions%60%E5%88%97%E8%A1%A8%E4%B8%AD%E5%90%84%E4%B8%AA%60action%60%E7%9A%84%E5%94%AF%E4%B8%80%E6%96%B9%E6%B3%95%E4%B8%BA%20%60partiallyUpdateAppWidget%60.%0A%E9%80%9A%E8%BF%87%E6%9F%A5%E9%98%85%E5%8F%91%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E5%9F%BA%E6%9C%AC%E4%B8%8A%E5%BE%88%E5%B0%91%E6%9C%89%60apk%60%E4%BD%BF%E7%94%A8.%E7%BB%8F%E5%B8%B8%E4%BD%BF%E7%94%A8%E7%9A%84%E6%8E%A5%E5%8F%A3%E4%B8%BA%60appWidgetManager.updateAppWidget%60%2C%E6%AD%A4%E6%AC%A1%E5%BD%95%E9%9F%B3%E6%9C%BA%E5%BA%94%E7%94%A8%E4%B9%9F%E6%98%AF%E8%B0%83%E7%94%A8%E7%9A%84%60updateAppWidget%60%E6%8E%A5%E5%8F%A3%E8%BF%9B%E8%A1%8C%E6%9B%B4%E6%96%B0%60UI%60.%0A%E6%9F%A5%E7%9C%8B%60RemoteViews.java%60%E4%BB%A3%E7%A0%81%E5%8F%91%E7%8E%B0%60RemoteView%60%E4%B8%AD%E7%9A%84%60set%E5%BC%80%E5%A4%B4%60%E7%9A%84%E6%96%B9%E6%B3%95%E5%9D%87%E4%BC%9Anew%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%60XXXaction%60%E6%B7%BB%E5%8A%A0%60mActions%60%E4%B8%AD%0A%60%60%60java%0Aframeworks%2Fbase%2Fcore%2Fjava%2Fandroid%2Fwidget%2FRemoteViews.java%0A%20%20%20%20public%20void%20setImageViewIcon(%40IdRes%20int%20viewId%2C%20Icon%20icon)%20%7B%0A%20%20%20%20%20%20%20%20setIcon(viewId%2C%20%22setImageIcon%22%2C%20icon)%3B%0A%20%20%20%20%7D%0A%20%20%20%20public%20void%20setIcon(%40IdRes%20int%20viewId%2C%20String%20methodName%2C%20Icon%20value)%20%7B%0A%20%20%20%20%20%20%20%20addAction(new%20ReflectionAction(viewId%2C%20methodName%2C%20BaseReflectionAction.ICON%2C%20value))%3B%0A%20%20%20%20%7D%0A%20%20%20%20public%20void%20setImageViewResource(%40IdRes%20int%20viewId%2C%20%40DrawableRes%20int%20srcId)%20%7B%0A%20%20%20%20%20%20%20%20setInt(viewId%2C%20%22setImageResource%22%2C%20srcId)%3B%0A%20%20%20%20%7D%0A%20%20%20%20public%20void%20setInt(%40IdRes%20int%20viewId%2C%20String%20methodName%2C%20int%20value)%20%7B%0A%20%20%20%20%20%20%20%20addAction(new%20ReflectionAction(viewId%2C%20methodName%2C%20BaseReflectionAction.INT%2C%20value))%3B%0A%20%20%20%20%7D%0A%09%2F%2F...%E7%AD%89%E7%AD%89%E6%96%B9%E6%B3%95%E5%9D%87%E4%BC%9Anew%E4%B8%80%E4%B8%AAAction%E6%B7%BB%E5%8A%A0%E5%88%B0mAction%E6%88%90%E5%91%98%E4%B8%AD%0A%60%60%60%0A%0A%E6%8E%92%E6%9F%A5%60appWidgetManager.updateAppWidget%60%20%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%3A%0A%E4%BB%A3%E7%90%86%E7%AB%AF%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%9C%80%E7%BB%88%E4%BC%9A%E8%B0%83%E7%94%A8%E5%AF%BC%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%9A%84%60updateAppWidgetIds(%2C)%60%E6%8E%A5%E5%8F%A3%0A%0A%60%60%60cpp%0A%2F%2Fframeworks%2Fbase%2Fservices%2Fappwidget%2Fjava%2Fcom%2Fandroid%2Fserver%2Fappwidget%2FAppWidgetServiceImpl.java%0A%2F%2F%E8%B0%83%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95%E4%B8%BAupdateAppWidgetIds%0A%20%20%20%20%40Override%0A%20%20%20%20public%20void%20updateAppWidgetIds(String%20callingPackage%2C%20int%5B%5D%20appWidgetIds%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20RemoteViews%20views)%20%7B%0A%20%20%20%20%20%20%20%20if%20(DEBUG)%20%7B%2F%2F%E5%9B%A0%E4%B8%BA%E6%9C%89%E5%BF%85%E7%8E%B0%E8%B7%AF%E5%BE%84%2C%E6%88%91%E5%B0%86%E8%BF%98%E5%B0%86%E6%AD%A4DEBUG%E8%BF%99%E4%B8%AA%E5%BC%80%E5%85%B3%E6%89%93%E5%BC%80%E4%BA%86%2C%E4%B8%BA%E4%BA%86%E8%83%BD%E5%8F%91%E7%8E%B0%E6%9B%B4%E5%A4%9A%E4%BF%A1%E6%81%AF%0A%20%20%20%20%20%20%20%20%20%20%20%20Slog.i(TAG%2C%20%22updateAppWidgetIds()%20%22%20%2B%20UserHandle.getCallingUserId())%3B%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20updateAppWidgetIds(callingPackage%2C%20appWidgetIds%2C%20views%2C%20false)%3B%2F%2F%E8%AF%A6%E8%A7%81%3A%20updateAppWidgetIds%0A%20%20%20%20%7D%0A%2F%2F%E8%BF%99%E4%B8%AA%E6%98%AF%E5%88%9A%E5%88%9A%E6%8F%90%E5%88%B0%E7%9A%84%20partiallyUpdateAppWidget%E8%B0%83%E7%94%A8%E5%88%B0%E7%9A%84%E6%8E%A5%E5%8F%A3%0A%20%20%20%20%40Override%0A%20%20%20%20public%20void%20partiallyUpdateAppWidgetIds(String%20callingPackage%2C%20int%5B%5D%20appWidgetIds%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20RemoteViews%20views)%20%7B%0A%20%20%20%20%20%20%20%20if%20(DEBUG)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20Slog.i(TAG%2C%20%22partiallyUpdateAppWidgetIds()%20%22%20%2B%20UserHandle.getCallingUserId())%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%2F%2F%E5%8F%82%E6%95%B0%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E4%B8%BAtrue%2C%E6%9C%80%E7%BB%88%E4%BC%9A%E5%B0%86%E6%96%B0%E6%97%A7%E4%B8%A4%E4%B8%AAaction%E5%90%88%E5%B9%B6%2C%E5%8D%B3%E7%A7%BB%E9%99%A4mActions%E7%9A%84%E5%94%AF%E4%B8%80%E5%9C%B0%E6%96%B9%0A%20%20%20%20%20%20%20%20updateAppWidgetIds(callingPackage%2C%20appWidgetIds%2C%20views%2C%20true)%3B%0A%20%20%20%20%7D%0A%60%60%60%0A**updateAppWidgetIds(%2C)**%0A%E9%80%9A%E8%BF%87appWidgetId%20%E6%89%BE%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84%E5%B0%8F%E9%83%A8%E4%BB%B6%E8%BF%9B%E8%A1%8C%E8%B7%9F%E6%96%B0%0A%60%60%60cpp%0A%20%20%20%20private%20void%20updateAppWidgetIds(String%20callingPackage%2C%20int%5B%5D%20appWidgetIds%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20RemoteViews%20views%2C%20boolean%20partially)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%E9%83%A8%E5%88%86%E7%9C%81%E7%95%A5%0A%20%20%20%20%20%20%20%20synchronized%20(mLock)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20final%20int%20N%20%3D%20appWidgetIds.length%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(int%20i%20%3D%200%3B%20i%20%3C%20N%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20final%20int%20appWidgetId%20%3D%20appWidgetIds%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F....%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Widget%20widget%20%3D%20lookupWidgetLocked(appWidgetId%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Binder.getCallingUid()%2C%20callingPackage)%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(widget%20!%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20updateAppWidgetInstanceLocked(widget%2C%20views%2C%20partially)%3B%2F%2F%E8%AF%A6%E8%A7%81updateAppWidgetInstanceLocked(widget%2C%20views%2C%20partially)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%60%60%60%0A%0A**updateAppWidgetInstanceLocked(%2C%2C)**%0A%E5%88%86%E6%9E%90%E5%A6%82%E4%B8%8B%0A%60%60%60cpp%0A%20%20%20%20private%20void%20updateAppWidgetInstanceLocked(Widget%20widget%2C%20RemoteViews%20views%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20boolean%20isPartialUpdate)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F...%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(isPartialUpdate%20%26%26%20widget.views%20!%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20For%20a%20partial%20update%2C%20we%20merge%20the%20new%20RemoteViews%20with%20the%20old.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20widget.views.mergeRemoteViews(views)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20For%20a%20full%20update%20we%20replace%20the%20RemoteViews%20completely.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20widget.views%20%3D%20views%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%E8%BF%99%E9%87%8C%E5%B0%86%E4%BC%9A%E7%BB%9F%E8%AE%A1%E5%B0%8F%E9%83%A8%E4%BB%B6%E4%B8%AD%E4%BD%BF%E7%94%A8BitMap%E5%86%85%E5%AD%98%2C%E5%A6%82%E6%9E%9C%E8%B6%85%E8%BF%87%E5%B1%8F%E5%B9%95%E5%AE%BD%C3%97%E9%AB%98%C3%971.5%C3%974%E5%A4%A7%E5%B0%8F%E5%B0%86%E4%BC%9A%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E9%80%A0%E6%88%90%E5%BA%94%E7%94%A8%E5%BC%82%E5%B8%B8%E9%80%80%E5%87%BA%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F***%E6%88%91%E4%BB%AC%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98system_server%E9%87%8D%E5%90%AF%E5%89%8D%E5%87%BA%E7%8E%B0%E4%BA%86%E5%BD%95%E9%9F%B3%E6%9C%BA%E7%94%B1%E4%BA%8E%E8%BF%99%E4%B8%AA%E5%8E%9F%E5%9B%A0%E9%97%AA%E9%80%80%E5%8F%AF%E6%9F%A5%E7%9C%8Bcrashlog%E4%B8%AD%E4%BF%A1%E6%81%AF%2C%E8%83%BD%E7%9C%8B%E5%88%B0%0A%20%20%20%20%20%20%20%20%20%20%20%20int%20memoryUsage%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20((UserHandle.getAppId(Binder.getCallingUid())%20!%3D%20Process.SYSTEM_UID)%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(widget.views%20!%3D%20null)%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20((memoryUsage%20%3D%20widget.views.estimateMemoryUsage())%20%3E%20mMaxWidgetBitmapMemory))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20widget.views%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20throw%20new%20IllegalArgumentException(%22RemoteViews%20for%20widget%20update%20exceeds%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20%22%20maximum%20bitmap%20memory%20usage%20(used%3A%20%22%20%2B%20memoryUsage%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2B%20%22%2C%20max%3A%20%22%20%2B%20mMaxWidgetBitmapMemory%20%2B%20%22)%22)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20scheduleNotifyUpdateAppWidgetLocked(widget%2C%20widget.getEffectiveViewsLocked())%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%60%60%60%0A*%20%E5%A6%82%E6%9E%9C%E6%98%AF%E9%83%A8%E5%88%86%E8%B7%9F%E6%96%B0(%60partiallyUpdateAppWidget%60)%2C%E5%B0%86%E4%BC%9A%E5%B0%86%60RemoteView%60%E4%B8%AD%E7%9A%84%60mAction%60%E8%BF%9B%E8%A1%8C%E6%96%B0%E8%80%81%60action%60%E5%90%88%E5%B9%B6%2C%E5%A6%82%E6%9E%9C%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E7%9A%84%60action%60%20%E9%82%A3%E4%B9%88%E6%96%B0%E7%9A%84%60action%60%E5%B0%86%E4%BC%9A%E4%B8%A2%E6%8E%89(%E5%85%B6%E5%AE%9E%E7%9C%8B%E5%88%B0%E8%BF%99%E9%87%8C%E6%88%91%E6%9C%89%E6%83%B3%E8%AE%A9%E5%BD%95%E9%9F%B3%E5%90%8C%E4%BA%8B%E4%BD%BF%E7%94%A8%60partiallyUpdateAppWidget%60%E4%BB%A3%E6%9B%BF%E4%BD%BF%E7%94%A8%60UpdateAppWidget%60%2C%E4%BD%86%E6%98%AF%E6%9F%A5%E9%98%85api%E8%B5%84%E6%96%99%E5%90%8E%2C%E5%8F%91%E7%8E%B0%E4%B8%A4%E8%80%85%E5%B9%B6%E4%B8%8D%E6%98%AF%E6%8F%90%E4%BB%A3%E7%9A%84%E5%85%B3%E7%B3%BB%2C%E4%BD%BF%E7%94%A8%60partiallyUpdateAppWidget%60%E5%9C%BA%E6%99%AF%E5%B9%B6%E4%B8%8D%E6%98%AF%E5%9C%A8%E6%B7%BB%E5%8A%A0action%E4%B9%8B%E5%90%8E%2C%E6%89%80%E4%BB%A5%E6%B2%A1%E6%9C%89%E8%AE%A9%E5%85%B6%E4%BF%AE%E6%94%B9)%0A*%20%E5%A6%82%E6%9E%9C%E6%98%AF%60UpdateAppWidget%60%E5%88%99%E5%B0%86%E6%96%B0%E7%9A%84%60RemoteView%60%E6%9B%BF%E6%8D%A2%E8%80%81%E7%9A%84%60RemoteView%60%2C%E9%97%B4%E6%8E%A5%E8%AF%B4%E6%98%8E%60mAction%60%E4%B9%9F%E4%BC%9A%E8%B7%9F%E7%9D%80%E5%8F%98%E5%8C%96(%E8%80%81RemoteView%E5%B0%86%E4%BC%9A%E8%A2%AB%E5%9B%9E%E6%94%B6%2C%E9%82%A3%E4%B9%88Action%E4%B9%9F%E5%B0%86%E4%BC%9A%E8%A2%AB%E5%9B%9E%E6%94%B6%2Cbitmap%E4%B9%9F%E5%B0%86%E8%A2%AB%E5%9B%9E%E6%94%B6).%0A%E4%BB%8E%E8%BF%99%E9%87%8C%E6%9D%A5%E7%9C%8B%2C%E6%AD%A3%E5%B8%B8%E6%9D%A5%E8%AF%B4%E4%B8%80RemoteView%E4%B8%8D%E5%BA%94%E8%AF%A5%E5%83%8Fhprof%E4%B8%AD%E9%82%A3%E6%A0%B7%E6%9C%891000%E5%A4%9A%E4%B8%AAaction%E7%9A%84.%E8%80%8C%E4%B8%94action%E5%A4%A7%E5%A4%9A%E9%83%BD%E6%98%AF%E5%8C%85%E5%90%ABBitmap.%E7%9C%8B%E5%88%B0%E8%BF%99%E9%87%8C%E6%88%91%E6%80%80%E7%96%91%E9%9A%BE%E9%81%93%E5%BD%95%E9%9F%B3%E6%9C%BA%E5%BA%94%E7%94%A8%E7%9A%84%E4%BB%A3%E7%A0%81%E4%B8%AD%E5%B0%86RemoteView%E4%BF%9D%E5%AD%98%E7%9D%80%2C%E9%87%8D%E5%A4%8D%E4%BD%BF%E7%94%A8%E5%90%97%3F%0A%0A%E6%89%80%E4%BB%A5%E5%92%A8%E8%AF%A2%E4%BA%86%E4%B8%80%E4%B8%8B%E5%BD%95%E9%9F%B3%E6%9C%BA%E7%9A%84%E5%BC%80%E5%8F%91%E6%98%AF%E5%90%A6%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E5%B0%86RemoteView%E4%BF%9D%E5%AD%98%E7%9D%80%2C%E9%87%8D%E5%A4%8D%E4%BD%BF%E7%94%A8%0A%0A!%5B0ad31ee54b4a2cb17184056e24db5996.png%5D(en-resource%3A%2F%2Fdatabase%2F5754%3A1)%0A%0A%E5%90%8E%E9%9D%A2%E6%88%91%E8%A6%81%E4%BA%86%E4%B8%80%E4%BB%BD%E5%85%B3%E4%BA%8E%20%E5%BD%95%E9%9F%B3%E6%9C%BA%E5%B0%8F%E9%83%A8%E4%BB%B6%E5%AE%9E%E7%8E%B0%E7%9A%84%E4%BB%A3%E7%A0%81%20%E5%8D%B3AppWidgetProvider%E7%B1%BB%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%9C%B0%E6%96%B9(%E9%99%84%E4%BB%B6%3A%20%60Bitmap%E6%B3%84%E6%BC%8Fsystem_server%E9%87%8D%E5%90%AF_resource%5CAppWidgetProvider.txt%60)%0A%3E%E6%88%91%E4%BB%AC%E4%B8%BB%E8%A6%81%E5%85%B3%E6%B3%A8%3A%0A%3E1.remote%E6%98%AF%E5%90%A6%E8%A2%AB%E5%A4%8D%E7%94%A8%0A%3E2.%E4%BB%A5%E5%8F%8AUpdateAppWidget%E7%9A%84%E8%B0%83%E7%94%A8%E6%97%B6%E6%9C%BA%0A%60%60%60kotlin%0Aclass%20RecorderWidgetProvider%3A%20AppWidgetProvider()%20%7B%0A%20%20%20%20%2F%2F%E6%97%A0%E5%85%B3%E4%BB%A3%E7%A0%81%E6%88%91%E8%BF%9B%E8%A1%8C%E7%9C%81%E7%95%A5%0A%20%20%20%20override%20fun%20onUpdate(context%3A%20Context%2C%20appWidgetManager%3A%20AppWidgetManager%2C%20appWidgetIds%3A%20IntArray)%20%7B%0A%20%20%20%20%20%20%20%20super.onUpdate(context%2C%20appWidgetManager%2C%20appWidgetIds)%0A%20%20%20%20%20%20%20%20val%20widgetView%20%3D%20RemoteViews(context.packageName%2C%20R.layout.recorder_widget_layout)%2F%2F%3C---------%E5%BC%82%E5%B8%B8%E7%82%B9RemoteViews%E5%AD%98%E5%9C%A8%E5%A4%8D%E7%94%A8%2C100%E4%B8%AA%E5%B0%8F%E9%83%A8%E4%BB%B6%E5%9C%BA%E6%99%AF%2C100%E4%B8%AA%E5%B0%8F%E9%83%A8%E4%BB%B6%E5%85%B1%E7%94%A8%E4%B8%80%E4%B8%AARemoteView%0A%20%20%20%20%20%20%20%20for%20(widgetId%20in%20appWidgetIds)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20updateWidgetView(context.applicationContext%2C%20widgetView%2C%20appWidgetManager%2C%20widgetId)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20private%20fun%20updateWidgetView(context%3A%20Context%2C%20widgetView%3A%20RemoteViews%2C%20manager%3A%20AppWidgetManager%2C%20appWidgetId%3A%20Int)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F....%E7%9C%81%E7%95%A5%0A%20%20%20%20%20%20%20%20widgetView.setImageViewIcon(R.id.bg_view%2C%20getBgBitmap(XXX).toIcon())%0A%20%20%20%20%20%20%20%20widgetView.setImageViewResource(R.id.icon%2C%20op(XXX))%0A%20%20%20%20%20%20%20%20manager.updateAppWidget(appWidgetId%2C%20widgetView)%2F%2F%3C----------------%E8%B0%83%E7%94%A8updateAppWidget%E8%BF%9B%E8%A1%8C%E6%9B%B4%E6%96%B0%0A%20%20%20%20%7D%0A%20%20%20%20override%20fun%20onEnabled(context%3A%20Context%3F)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F...%0A%20%20%20%20%7D%0A%20%20%20%20override%20fun%20onDisabled(context%3A%20Context%3F)%20%7B%0A%20%20%20%20%20%20%20%20%20%2F%2F...%0A%20%20%20%20%7D%0A%20%20%20%20override%20fun%20onReceive(context%3A%20Context%2C%20intent%3A%20Intent)%20%7B%0A%20%20%20%20%20%20%20%20%20%2F%2F...%0A%20%20%20%20%7D%0A%20%20%20%20override%20fun%20onAppWidgetOptionsChanged(context%3A%20Context%2C%20appWidgetManager%3A%20AppWidgetManager%2C%20appWidgetId%3A%20Int%2C%20newOptions%3A%20Bundle)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F...%0A%20%20%20%20%7D%0A%7D%0A%0A%60%60%60%0A%E4%BB%8E%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E6%88%91%E4%BB%AC%E7%A1%AE%E5%AE%9E%E8%83%BD%E5%8F%91%E7%8E%B0%E5%AD%98%E5%9C%A8%60RemoteView%60%E5%A4%8D%E7%94%A8%E7%9A%84%E6%83%85%E5%86%B5%3A%0A%E5%8D%B3%E4%B8%80%E4%B8%AA%60RemoteView%60%E8%B0%83%E7%94%A8%60setImageViewIcon%60%2C%E6%89%80%E6%9C%89%E5%85%B6%E4%BB%96%E5%B0%8F%E9%83%A8%E4%BB%B6%E8%A2%AB%E5%BC%95%E7%94%A8%E7%9A%84%60RemoteView%60%E4%B8%AD%E7%9A%84%60mActions%60%E5%88%97%E8%A1%A8%E9%83%BD%E4%BC%9A%E5%A2%9E%E5%8A%A0%0A%23%23%23%203.5%E4%BF%AE%E6%94%B9%E5%BB%BA%E8%AE%AE%0A%E6%88%91%E7%BB%99%E5%BD%95%E9%9F%B3%E6%9C%BA%E5%BC%80%E5%8F%91%E5%90%8C%E4%BA%8B%E6%8F%90%E5%BB%BA%E8%AE%AE%E5%B0%86%60RemoteView%60%20%E6%94%BE%E5%88%B0%60for%E5%BE%AA%E7%8E%AF%60%E4%B8%AD%2C%E8%BF%99%E6%A0%B7%E4%B8%80%E4%B8%AA%E5%B0%8F%E9%83%A8%E4%BB%B6%E5%B0%B1%E5%8F%AA%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%80%E4%B8%AA%60RemoteView%60.%0A%60%60%60kotlin%0Aclass%20RecorderWidgetProvider%3A%20AppWidgetProvider()%20%7B%0A%20%20%20%20override%20fun%20onUpdate(context%3A%20Context%2C%20appWidgetManager%3A%20AppWidgetManager%2C%20appWidgetIds%3A%20IntArray)%20%7B%0A%20%20%20%20%20%20%20%20super.onUpdate(context%2C%20appWidgetManager%2C%20appWidgetIds)%0A%20%20%20%20%20%20%20%20for%20(widgetId%20in%20appWidgetIds)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%5C%5CappWidget%E5%AF%B9%E5%BA%94%E4%B8%80%E4%B8%AA%E6%96%B0RemoteView%0A%20%20%20%20%20%20%20%20%20%20%20%20val%20widgetView%20%3D%20RemoteViews(context.packageName%2C%20R.layout.recorder_widget_layout)%5C%5CappWidget%E5%AF%B9%E5%BA%94%E4%B8%80%E4%B8%AA%E6%96%B0RemoteView%0A%20%20%20%20%20%20%20%20%20%20%20%20updateWidgetView(context.applicationContext%2C%20widgetView%2C%20appWidgetManager%2C%20widgetId)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D%0A%60%60%60%0A%E4%BD%BF%E7%94%A8%E4%BF%AE%E6%94%B9%E5%90%8E%E7%9A%84%E5%BD%95%E9%9F%B3%E6%9C%BA%E8%BF%9B%E8%A1%8C%E5%9C%A8%E7%9B%B8%E5%90%8C%E6%89%8B%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%89%88%E6%9C%AC%E6%B5%8B%E8%AF%95%2C%E6%89%8B%E6%9C%BA%E4%BD%BF%E7%94%A8%E6%B5%81%E7%95%85%2C%E5%B0%8F%E9%83%A8%E4%BB%B6UI%E6%B5%81%E7%95%85%2C%E4%BA%AE%E7%81%AD%E5%B1%8F10%E5%A4%9A%E6%AC%A1%2C%E6%9C%AA%E8%A7%81%E9%87%8D%E5%90%AF%2C%E4%B9%9F%E6%9C%AA%E8%A7%81%E6%89%93%E5%8D%B0bitmap%E5%BC%82%E5%B8%B8log(%E5%8F%AF%E7%9C%8B%E9%99%84%E4%BB%B6%E4%B8%AD%E4%BF%AE%E6%94%B9%E7%9A%84%E5%BD%95%E5%B1%8F)%0A%E6%8A%93%E4%BA%86%E4%B8%80%E4%BB%BD%E5%BD%95%E9%9F%B36%E5%B0%8F%E6%97%B6%E5%90%8E%60hprof%60(%60Bitmap%E6%B3%84%E6%BC%8Fsystem_server%E9%87%8D%E5%90%AF_resource%5C1_%E9%97%AE%E9%A2%98log%5CAfter_Modified_Catch_memory-20231012T210526.hprof%60)%2C%0A%E7%9C%8B%E4%B8%80%E4%B8%8B%E6%98%AF%E4%B8%8D%E6%98%AFbitMap%E7%9A%84%E5%88%86%E9%85%8D%E4%B8%AA%E6%95%B0%E5%92%8C%E5%86%85%E5%AD%98%E7%9A%84%E5%A4%A7%E5%B0%8F%E6%98%AF%E4%B8%8D%E6%98%AF%E5%B0%8F%E5%BE%88%E5%A4%9A%E6%AF%94%E8%B5%B7%E4%B9%8B%E5%89%8D%0A%0A%0A!%5Babeffd5a9b46c073eb7102a79d233ae0.png%5D(en-resource%3A%2F%2Fdatabase%2F5756%3A1)%0A%7C%20%E6%97%B6%E9%97%B4%20%7C%20%E5%BC%82%E5%B8%B8%E6%97%B6Allocations%20%7CNative%20Size%7C%0A%7C%20---%20%7C%20---%20%7C---%20%7C%0A%7C%20%E5%BC%82%E5%B8%B8%E6%97%B6%20%7C11122%20%7C754702978%7C%0A%7C%20%E4%BF%AE%E6%94%B9%E5%90%8E%7C%20554%20%7C45047954%7C%0A%0A%0A%0A%0A%23%23%204.%E5%8F%82%E8%80%83%0A%0A%23%23%23%204.1%20hprof%E7%9A%84%E5%87%A0%E4%B8%AA%E5%86%85%E5%AD%98%E5%85%B3%E9%94%AE%E5%8F%82%E6%95%B0%E8%A7%A3%E9%87%8A%0A%E5%85%B3%E4%BA%8E%E8%BF%99%E5%87%A0%E9%A1%B9%E7%9A%84%E4%BF%A1%E6%81%AF%E5%A6%82%E4%B8%8B%0A%0A**Allocations**%EF%BC%9A%E5%A0%86%E4%B8%AD%E7%9A%84%E5%88%86%E9%85%8D%E6%95%B0%E3%80%82%0A**Native%20Size**%EF%BC%9A%E6%AD%A4%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E4%BD%BF%E7%94%A8%E7%9A%84%E5%8E%9F%E7%94%9F%E5%86%85%E5%AD%98%E6%80%BB%E9%87%8F%EF%BC%88%E4%BB%A5%E5%AD%97%E8%8A%82%E4%B8%BA%E5%8D%95%E4%BD%8D%EF%BC%89%E3%80%82%E5%8F%AA%E6%9C%89%E5%9C%A8%E4%BD%BF%E7%94%A8%20Android%207.0%20%E5%8F%8A%E6%9B%B4%E9%AB%98%E7%89%88%E6%9C%AC%E6%97%B6%EF%BC%8C%E6%89%8D%E4%BC%9A%E7%9C%8B%E5%88%B0%E6%AD%A4%E5%88%97%E3%80%82%E6%82%A8%E4%BC%9A%E5%9C%A8%E6%AD%A4%E5%A4%84%E7%9C%8B%E5%88%B0%E9%87%87%E7%94%A8%20Java%20%E5%88%86%E9%85%8D%E7%9A%84%E6%9F%90%E4%BA%9B%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%86%85%E5%AD%98%EF%BC%8C%E5%9B%A0%E4%B8%BA%20%60Android%20%60%E5%AF%B9%E6%9F%90%E4%BA%9B%E6%A1%86%E6%9E%B6%E7%B1%BB%EF%BC%88%E5%A6%82%C2%A0%60Bitmap%60%EF%BC%89%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9F%E5%86%85%E5%AD%98%E3%80%82%0A**Shallow%20Size**%EF%BC%9A%E6%AD%A4%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E4%BD%BF%E7%94%A8%E7%9A%84%20Java%20%E5%86%85%E5%AD%98%E6%80%BB%E9%87%8F%EF%BC%88%E4%BB%A5%E5%AD%97%E8%8A%82%E4%B8%BA%E5%8D%95%E4%BD%8D%EF%BC%89%E3%80%82%0A**Retained%20Size**%EF%BC%9A%E4%B8%BA%E6%AD%A4%E7%B1%BB%E7%9A%84%E6%89%80%E6%9C%89%E5%AE%9E%E4%BE%8B%E8%80%8C%E4%BF%9D%E7%95%99%E7%9A%84%E5%86%85%E5%AD%98%E6%80%BB%E5%A4%A7%E5%B0%8F%EF%BC%88%E4%BB%A5%E5%AD%97%E8%8A%82%E4%B8%BA%E5%8D%95%E4%BD%8D%EF%BC%89%E3%80%82%0A%3Efrom%3Ahttps%3A%2F%2Fdeveloper.android.google.cn%2Fstudio%2Fprofile%2Fmemory-profiler%3Fhl%3Dzh-cn%0A%0A%E4%B8%8A%E9%9D%A2%E5%87%A0%E4%B8%AA%E6%A6%82%E5%BF%B5%E6%9D%A5%E6%BA%90%E5%AE%98%E7%BD%91%E6%AF%94%E8%BE%83%E7%94%9F%E7%A1%AC%2C%E8%BE%83%E5%AE%B9%E6%98%93%E7%90%86%E8%A7%A3%E7%9A%84%E5%A6%82%E4%B8%8B%3A%0A%0A%0A*%20**Native%20Size**%0A*%20**Shallow%20Size**%0A*%20**Retained%20Size**%0A%0A%E6%88%91%E4%BB%AC%E7%94%A8%E4%B8%8B%E5%9B%BE%E6%9D%A5%E8%A1%A8%E7%A4%BA%E6%9F%90%E6%AE%B5%20%60Heap%20Dump%60%20%E8%AE%B0%E5%BD%95%E7%9A%84%E5%BA%94%E7%94%A8%E5%86%85%E5%AD%98%E7%8A%B6%E6%80%81%E3%80%82%E6%B3%A8%E6%84%8F%E7%BA%A2%E8%89%B2%E7%9A%84%E8%8A%82%E7%82%B9%EF%BC%8C%E5%9C%A8%E8%BF%99%E4%B8%AA%E7%A4%BA%E4%BE%8B%E4%B8%AD%EF%BC%8C%E8%BF%99%E4%B8%AA%E8%8A%82%E7%82%B9%E6%89%80%E4%BB%A3%E8%A1%A8%E7%9A%84%E5%AF%B9%E8%B1%A1%E4%BB%8E%E6%88%91%E4%BB%AC%E7%9A%84%E5%B7%A5%E7%A8%8B%E4%B8%AD%E5%BC%95%E7%94%A8%E4%BA%86%20Native%20%E5%AF%B9%E8%B1%A1%3A%0A!%5Be5c3b591a4574569b0d266796bc071da.png%5D(en-resource%3A%2F%2Fdatabase%2F5746%3A1)%0A%0A%E8%BF%99%E7%A7%8D%E6%83%85%E5%86%B5%E4%B8%8D%E5%A4%AA%E5%B8%B8%E8%A7%81%EF%BC%8C%E4%BD%86%E5%9C%A8%20Android%208.0%20%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BD%BF%E7%94%A8%20%60Bitmap%60%20%E4%BE%BF%E5%8F%AF%E8%83%BD%E4%BA%A7%E7%94%9F%E6%AD%A4%E7%B1%BB%E6%83%85%E6%99%AF%EF%BC%8C%E5%9B%A0%E4%B8%BA%20%60Bitmap%60%20%E4%BC%9A%E6%8A%8A%E5%83%8F%E7%B4%A0%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8%E5%9C%A8%E5%8E%9F%E7%94%9F%E5%86%85%E5%AD%98%E4%B8%AD%E6%9D%A5%E5%87%8F%E5%B0%91%20%60JVM%60%20%E7%9A%84%E5%86%85%E5%AD%98%E5%8E%8B%E5%8A%9B%E3%80%82(%E6%88%91%E4%BB%AC%E7%9A%84%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%E5%B0%B1%E6%98%AF%E8%BF%99%E6%A0%B7)%0A%0A%0A%E5%85%88%E4%BB%8E%20%60Shallow%20Size%60%20%E8%AE%B2%E8%B5%B7%EF%BC%8C%E8%BF%99%E5%88%97%E6%95%B0%E6%8D%AE%E5%85%B6%E5%AE%9E%E9%9D%9E%E5%B8%B8%E7%AE%80%E5%8D%95%EF%BC%8C%E5%B0%B1%E6%98%AF%E5%AF%B9%E8%B1%A1%E6%9C%AC%E8%BA%AB%E6%B6%88%E8%80%97%E7%9A%84%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F%EF%BC%8C%E5%9C%A8%E4%B8%8A%E5%9B%BE%E4%B8%AD%EF%BC%8C%E5%8D%B3%E4%B8%BA**%E7%BA%A2%E8%89%B2%E8%8A%82%E7%82%B9**%E8%87%AA%E8%BA%AB%E6%89%80%E5%8D%A0%E5%86%85%E5%AD%98%E3%80%82%E8%80%8C%20%60Native%20Size%60%C2%A0%E5%90%8C%E6%A0%B7%E4%B9%9F%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%8C%E5%AE%83%E6%98%AF%E7%B1%BB%E5%AF%B9%E8%B1%A1%E6%89%80%E5%BC%95%E7%94%A8%E7%9A%84%20%60Native%60%20%E5%AF%B9%E8%B1%A1%20(**%E8%93%9D%E8%89%B2%E8%8A%82%E7%82%B9**)%20%E6%89%80%E6%B6%88%E8%80%97%E7%9A%84%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F%3A%0A%0A!%5B61d0ee136efb76b099e79b249dbc14b9.png%5D(en-resource%3A%2F%2Fdatabase%2F5748%3A1)%0A%0A%60Retained%20Size%60%20%E7%A8%8D%E5%A4%8D%E6%9D%82%E4%BA%9B%EF%BC%8C%E5%AE%83%E6%98%AF%E4%B8%8B%E5%9B%BE%E4%B8%AD%E6%89%80%E6%9C%89%E6%A9%99%E8%89%B2%E8%8A%82%E7%82%B9%E7%9A%84%E5%A4%A7%E5%B0%8F%3A%0A!%5B755f12022220d96df9e67b20e9981c2f.png%5D(en-resource%3A%2F%2Fdatabase%2F5750%3A1)%0A%0A%E7%94%B1%E4%BA%8E%E4%B8%80%E6%97%A6%E5%88%A0%E9%99%A4%E7%BA%A2%E8%89%B2%E8%8A%82%E7%82%B9%EF%BC%8C%E5%85%B6%E4%BD%99%E7%9A%84%E6%A9%99%E8%89%B2%E8%8A%82%E7%82%B9%E9%83%BD%E5%B0%86%E6%97%A0%E6%B3%95%E8%A2%AB%E8%AE%BF%E9%97%AE%EF%BC%8C%E8%BF%99%E6%97%B6%E5%80%99%E5%AE%83%E4%BB%AC%E5%B0%B1%E4%BC%9A%E8%A2%AB%20GC%20%E5%9B%9E%E6%94%B6%E6%8E%89%E3%80%82%E4%BB%8E%E8%BF%99%E4%B8%AA%E8%A7%92%E5%BA%A6%E4%B8%8A%E8%AE%B2%EF%BC%8C%E5%AE%83%E4%BB%AC%E6%98%AF%E8%A2%AB%E7%BA%A2%E8%89%B2%E8%8A%82%E7%82%B9%E6%89%80%E6%8C%81%E6%9C%89%E7%9A%84%EF%BC%8C%E5%9B%A0%E6%AD%A4%E8%A2%AB%E5%91%BD%E5%90%8D%E4%B8%BA%20%60Retained%20Size%60%E3%80%82%0A%E5%8F%82%E8%80%83%0A%3E%E4%BD%BF%E7%94%A8%20Android%20Studio%20Profiler%20%E5%B7%A5%E5%85%B7%E8%A7%A3%E6%9E%90%E5%BA%94%E7%94%A8%E7%9A%84%E5%86%85%E5%AD%98%E5%92%8C%20CPU%20%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%0A%3Ehttps%3A%2F%2Fmp.weixin.qq.com%2Fs%2FMIuSi85lnrETqq3rl0Hc6A%0A%3ERemoteViews%20%E4%B8%AD%E6%9A%97%E8%97%8F%E7%9A%84%E5%9D%91%0A%3Ehttps%3A%2F%2Fblog.csdn.net%2Fu013989732%2Farticle%2Fdetails%2F78501462%0A</center></span>
</div></body></html> 